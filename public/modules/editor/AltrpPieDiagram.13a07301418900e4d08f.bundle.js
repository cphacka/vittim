(self.webpackChunk=self.webpackChunk||[]).push([[78],{10895:function(e,t,n){"use strict";n.d(t,{O:function(){return u}});var r=n(90484),i=n(92137),a=n(87757),o=n.n(a),l=n(9669),s=n.n(l),c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.keys(e).reduce((function(t,n,r){return[t,0===r?"?":"&",n=encodeURIComponent(n),"=",encodeURIComponent(e[n])].join("")}),"");return console.log("RESULT ==>",t),t},u=function(){var e=(0,i.Z)(o().mark((function e(t,n){var i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i="","object"===(0,r.Z)(n)?i=c(n):void 0!==n&&(i=c(JSON.parse(n))),e.prev=2,e.next=5,s()(t+i,{});case 5:return e.abrupt("return",e.sent);case 8:return e.prev=8,e.t0=e.catch(2),console.log(e.t0),e.abrupt("return",{status:500});case 12:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t,n){return e.apply(this,arguments)}}()},78478:function(e,t,n){"use strict";var r=n(22122),i=n(96156),a=n(92137),o=n(28481),l=n(87757),s=n.n(l),c=n(67294),u=n(73445),d=n(65056),h=n(5367),p=n(23233),f=n(10895),m=n(30381),v=n.n(m),g=n(59073),b=n(33695);function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var O=_.find(p.Z,{value:"regagro"}).colors,k=_.find(p.Z,{value:"milk"}).colors,E=_.find(p.Z,{value:"milk2"}).colors,w=function(e){var t=e.dataWithArc,n=e.centerX,r=e.centerY,i=0;return t.forEach((function(e){i+=e.value})),c.createElement("svg",null,c.createElement("text",{x:n,y:r,textAnchor:"middle",dominantBaseline:"central",className:"centered-metric"},i))};t.Z=function(e){var t=e.widget,n=e.width,i=void 0===n?"300px":n,l=e.height,p=void 0===l?"450px":l,m=e.dataSource,y=void 0===m?[]:m,S=e.colorScheme,Z=void 0===S?"red_grey":S,R=e.enableSliceLabels,D=void 0!==R&&R,M=e.innerRadius,P=void 0===M?0:M,j=e.padAngle,C=void 0===j?0:j,L=e.cornerRadius,A=void 0===L?0:L,I=e.sortByValue,N=void 0===I?0:I,B=e.enableRadialLabels,T=void 0===B||B,V=e.sort,Y=void 0===V?"":V,q=e.tickRotation,z=void 0===q?0:q,U=e.bottomAxis,H=void 0===U||U,W=e.keyIsDate,X=void 0!==W&&W,F=e.customColorSchemeChecker,J=void 0!==F&&F,Q=e.customColors,G=void 0===Q?[]:Q,K=e.widgetID,$=e.useCustomTooltips,ee=e.margin,te=e.title,ne=e.subTitle,re=e.legend,ie=e.activeOuterRadiusOffset,ae=e.activeInnerRadiusOffset,oe=e.useCenteredMetric,le=e.useLinkArcLabels,se=e.useProcent;re&&Object.keys(re).forEach((function(e){return void 0===re[e]&&delete re[e]}));var ce=0;y.forEach((function(e){return ce+=e.value}));var ue=(0,c.useState)(!1),de=(0,o.Z)(ue,2),he=de[0],pe=de[1],fe=(0,c.useState)([]),me=(0,o.Z)(fe,2),ve=me[0],ge=me[1],be=(0,c.useCallback)((0,a.Z)(s().mark((function e(){var n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(pe(!0),0!=y.length){e.next=8;break}return e.next=4,(0,f.O)(t.source,t.filter);case 4:200===(n=e.sent).status&&(r=n.data.data.map((function(e){var t=e.key,n=v()(t).isValid()?v()(t).format("DD.MM.YYYY"):t;return{value:Number(e.data),id:X?n:t}})),ge(r||[]),pe(!1)),e.next=20;break;case 8:if(null===Y||"undefined"===Y||void 0===y){e.next=18;break}e.t0=Y,e.next="value"===e.t0?12:"key"===e.t0?14:16;break;case 12:return y=_.sortBy(y,["value"]),e.abrupt("break",18);case 14:return y=_.sortBy(y,["id"]),e.abrupt("break",18);case 16:return y=y,e.abrupt("break",18);case 18:ge(y||[]),pe(!1);case 20:case"end":return e.stop()}}),e)}))),[t]);(0,c.useEffect)((function(){be()}),[be]);var ye=["arcs","arcLabels","arcLinkLabels","legends"];oe&&ye.push(w);var _e={};return le||(_e.arcLinkLabelComponent=function(){return c.createElement("text",null)}),he?c.createElement(d.Z,null):ve&&0!==ve.length?c.createElement(c.Fragment,null,te&&c.createElement("h3",{className:"diagram-title",style:{margin:0}},te),ne&&c.createElement("h5",{className:"diagram-subtitle",style:{margin:0}},ne),c.createElement("div",{className:"diagram",style:{height:p,width:i}},c.createElement(u.Y2,(0,r.Z)({data:ve,colors:J&&G.length>0?G:"regagro"===Z?O:"milk"===Z?k:"milk2"===Z?E:{scheme:Z},tooltip:function(e){return c.createElement(b.Z,{enable:$,datum:e,data:ve,widgetID:K})},cornerRadius:A,sortByValue:N,axisBottom:H&&{tickRotation:z},margin:ee,enableRadialLabels:T,legends:re&&[x({anchor:"top-right",direction:"column",translateX:0,translateY:0,itemsSpacing:2,itemWidth:60,itemHeight:14,itemDirection:"left-to-right",itemOpacity:1,symbolSize:14,symbolShape:"circle"},re)],innerRadius:P,enableSliceLabels:D,padAngle:C,animate:!0,activeOuterRadiusOffset:ie,activeInnerRadiusOffset:ae,layers:ye,arcLabelsComponent:function(e){var t=e.datum,n=e.label,r=e.style;return console.log({datum:t}),c.createElement(g.q.g,{transform:r.transform,style:{pointerEvents:"none"}},c.createElement("text",{textAnchor:"middle",dominantBaseline:"central",className:"arc-label"},n," ",se?" (".concat(Math.round(n/ce*100),"%)"):""))}},_e)))):c.createElement(h.Z,null)}},5367:function(e,t,n){"use strict";var r=n(67294);t.Z=function(e){var t=e.text;return r.createElement("div",{className:"spinner-container"},r.createElement("div",{className:"spinner-container__text"},t||"Данные обрабатываются"))}},65056:function(e,t,n){"use strict";var r=n(67294);t.Z=function(){return r.createElement("div",{className:"spinner-container"},r.createElement("div",{className:"spinner-border",style:{width:"3rem",height:"3rem"},role:"status"},r.createElement("span",{className:"sr-only"},"Загрузка...")))}},33695:function(e,t,n){"use strict";var r=n(96156),i=n(6610),a=n(5991),o=n(10379),l=n(46070),s=n(77608),c=n(67294);function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var h=function(e){(0,o.Z)(u,e);var t,n,r=(t=u,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,s.Z)(t);if(n){var i=(0,s.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,l.Z)(this,e)});function u(e){var t,n,a,o;return(0,i.Z)(this,u),(o=r.call(this,e)).state={indexValue:null===(t=e.datum)||void 0===t?void 0:t.indexValue,value:null===(n=e.datum)||void 0===n?void 0:n.value,color:null===(a=e.datum)||void 0===a?void 0:a.color,enable:null==e?void 0:e.enable,settings:null==e?void 0:e.settings},o}return(0,a.Z)(u,[{key:"componentDidUpdate",value:function(e,t){var n=this;_.isEqual(e.enable,this.props.enable)||this.setState((function(e){var t;return d(d({},e),{},{enable:null===(t=n.props)||void 0===t?void 0:t.enable})}))}},{key:"render",value:function(){var e,t,n,r;return this.state.enable?c.createElement("div",{className:"".concat(this.props.widgetID," altrp-dashboard__tooltip--font altrp-dashboard__tooltip--label-background altrp-dashboard__tooltip--width altrp-dashboard__tooltip--label-background-shadow altrp-dashboard__tooltip--border-type altrp-dashboard__tooltip--border-width altrp-dashboard__tooltip--border-color col-12"),style:{padding:"5px 9px"}},c.createElement("div",null,c.createElement("div",{style:{color:"white",display:"flex"}},c.createElement("div",{style:{height:"100%",display:"flex",alignItems:"center"}},c.createElement("div",{style:{width:"15px",height:"15px",background:this.props.datum.datum.color||"#000000",marginRight:"3px",marginTop:"1px"}})),null===(e=this.props.datum)||void 0===e||null===(t=e.datum)||void 0===t?void 0:t.label,":",c.createElement("strong",null,null===(n=this.props.datum)||void 0===n||null===(r=n.datum)||void 0===r?void 0:r.value)))):c.createElement(c.Fragment,null,c.createElement("div",{style:{background:"white",color:"inherit",fontSize:"{{SIZE}}px",borderRadius:"2px",boxShadow:"rgba(0, 0, 0, 0.25) 0px 1px 2px",padding:"5px 9px"}},c.createElement("div",{style:{whiteSpace:"pre",display:"flex",alignItems:"center"}},c.createElement("span",{style:{display:"block",width:"12px",height:"12px",background:this.props.datum.datum.color,marginRight:"7px"}}),c.createElement("span",null,this.props.datum.datum.label,":"," ",c.createElement("strong",null,this.props.datum.datum.value)))))}}]),u}(c.PureComponent);t.Z=h},34742:function(e,t,n){"use strict";n.r(t);var r=n(85061),i=n(67294),a=n(14494),o=n(78478),l=(n(23233),n(18354)),s=n(30381),c=n.n(s);t.default=(0,a.connect)((function(e){return{currentDataStorage:e.currentDataStorage}}))((function(e){var t,n,s,u,d,h,p,f,m,v=e.settings,g=e.id,b=((0,a.useDispatch)(),null==v||v.widget_name,null==v?void 0:v.isCustomColor),y=null==v||null===(t=v.customScheme)||void 0===t?void 0:t.map((function(e){return _.get(e,"color.colorPickedHex")})),x=null==v?void 0:v.customTooltip,O=null===(n=v.query)||void 0===n||null===(s=n.dataSource)||void 0===s?void 0:s.value,k=v.key_is_date,E=v.activeOuterRadiusOffset,w=v.margin,S=v.yScaleMax,Z=v.colorScheme,R=v.isMultiple,D=(v.isCustomColor,v.sort),M=v.tickRotation,P=v.bottomAxis,j=v.innerRadius,C=v.enableSliceLabels,L=v.padAngle,A=v.cornerRadius,I=v.sortByValue,N=v.enableRadialLabels,B=v.activeInnerRadiusOffset,T=v.useCenteredMetric,V=v.useLinkArcLabels,Y=v.useProcent,q=[],z=function(e,t){return e.map((function(e,n){var r,i=_.get(e,t.key),a=c()(i).isValid()?c()(i).format("DD.MM.YYYY"):i,o="undefined"!=typeof tooltipValues?null===(r=tooltipValues)||void 0===r?void 0:r.map((function(t){return{label:null==t?void 0:t.label,value:_.get(e,t.field),color:null==t?void 0:t.color}})):[];return{value:Number(_.get(e,t.data)),id:k?a:i,tooltip:o}}))};if((0,l.isEditor)())q=[{id:"Demo data 1",value:60,tooltip:[]},{id:"Demo data 2",date:"2013-01",value:200,tooltip:[]},{id:"Demo data 3",date:"2013-01",value:20,tooltip:[]},{id:"Demo data 4",date:"2013-01",value:10,tooltip:[]},{id:"Demo data 5",date:"2013-01",value:50,tooltip:[]}];else if(R)q=_.cloneDeep(v.rep,[]).map((function(e,t){var n=(0,l.getDataByPath)(e.path,[]);return n.length>0&&(n=_.uniqBy(n,e.key),n=z(n,e)),n})),q=(m=[]).concat.apply(m,(0,r.Z)(q));else if(null!=v.datasource_path)try{q=(0,l.getDataByPath)(v.datasource_path,[]);var U={key:v.key_name,data:v.data_name};q=z(q,U)}catch(e){console.log("===================================="),console.error(e),console.log("===================================="),q=[{id:v.datasource_title||v.datasource_path,data:[]}]}if(!O&&0===q.length)return i.createElement("div",{className:"altrp-chart ".concat(v.legendPosition)},"Идет загрузка данных...");var H={source:O+function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!e)return"";var t=e.split("\n"),n=t.map((function(e){return e.replace("|","=")})).join("&");return"?".concat(n)}(null===(u=v.query)||void 0===u?void 0:u.defaultParams),options:{colorScheme:v.colorScheme,legend:v.legend,animated:v.animated,isVertical:v.isVertical},filter:{}};return console.log("===================================="),console.log(q),console.log("===================================="),i.createElement(o.Z,{useProcent:Y,widgetID:g,margin:w,useCustomTooltips:x,yScaleMax:S,customColorSchemeChecker:b,customColors:y,isMultiple:R,dataSource:q,colorScheme:Z,widget:H,width:"".concat(null===(d=v.width)||void 0===d?void 0:d.size).concat(null===(h=v.width)||void 0===h?void 0:h.unit),height:"".concat(null===(p=v.height)||void 0===p?void 0:p.size).concat(null===(f=v.height)||void 0===f?void 0:f.unit),innerRadius:j,enableSliceLabels:C,padAngle:L,cornerRadius:A,sortByValue:I,enableRadialLabels:N,sort:D,tickRotation:M,bottomAxis:P,title:v.datasource_title,subTitle:v.subtitle,legend:v.use_legend&&{anchor:v.legend_anchor,direction:v.legend_direction,itemDirection:v.legend_item_direction,translateX:v.legend_translate_x,translateY:v.legend_translate_y,itemsSpacing:v.legend_items_spacing,itemWidth:v.legend_item_width,itemHeight:v.legend_item_height,itemOpacity:v.legend_item_opacity,symbolSize:v.legend_symbol_size,symbolShape:v.legend_symbol_shape},keyIsDate:k,activeOuterRadiusOffset:E,activeInnerRadiusOffset:B,useCenteredMetric:T,useLinkArcLabels:V})}))},11108:function(e,t){"use strict";var n=Math.PI,r=2*n,i=1e-6,a=r-i;function o(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function l(){return new o}o.prototype=l.prototype={constructor:o,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,r){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+r)},bezierCurveTo:function(e,t,n,r,i,a){this._+="C"+ +e+","+ +t+","+ +n+","+ +r+","+(this._x1=+i)+","+(this._y1=+a)},arcTo:function(e,t,r,a,o){e=+e,t=+t,r=+r,a=+a,o=+o;var l=this._x1,s=this._y1,c=r-e,u=a-t,d=l-e,h=s-t,p=d*d+h*h;if(o<0)throw new Error("negative radius: "+o);if(null===this._x1)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(p>i)if(Math.abs(h*c-u*d)>i&&o){var f=r-l,m=a-s,v=c*c+u*u,g=f*f+m*m,b=Math.sqrt(v),y=Math.sqrt(p),_=o*Math.tan((n-Math.acos((v+p-g)/(2*b*y)))/2),x=_/y,O=_/b;Math.abs(x-1)>i&&(this._+="L"+(e+x*d)+","+(t+x*h)),this._+="A"+o+","+o+",0,0,"+ +(h*f>d*m)+","+(this._x1=e+O*c)+","+(this._y1=t+O*u)}else this._+="L"+(this._x1=e)+","+(this._y1=t)},arc:function(e,t,o,l,s,c){e=+e,t=+t,c=!!c;var u=(o=+o)*Math.cos(l),d=o*Math.sin(l),h=e+u,p=t+d,f=1^c,m=c?l-s:s-l;if(o<0)throw new Error("negative radius: "+o);null===this._x1?this._+="M"+h+","+p:(Math.abs(this._x1-h)>i||Math.abs(this._y1-p)>i)&&(this._+="L"+h+","+p),o&&(m<0&&(m=m%r+r),m>a?this._+="A"+o+","+o+",0,1,"+f+","+(e-u)+","+(t-d)+"A"+o+","+o+",0,1,"+f+","+(this._x1=h)+","+(this._y1=p):m>i&&(this._+="A"+o+","+o+",0,"+ +(m>=n)+","+f+","+(this._x1=e+o*Math.cos(s))+","+(this._y1=t+o*Math.sin(s))))},rect:function(e,t,n,r){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +r+"h"+-n+"Z"},toString:function(){return this._}},t.Z=l},93072:function(e,t,n){"use strict";function r(e){return function(){return e}}n.d(t,{Z:function(){return r}})},25049:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var r=n(11108),i=n(93072),a=n(18143),o=n(78260);function l(){var e=o.x,t=o.y,n=(0,i.Z)(!0),l=null,s=a.Z,c=null;function u(i){var a,o,u,d=i.length,h=!1;for(null==l&&(c=s(u=(0,r.Z)())),a=0;a<=d;++a)!(a<d&&n(o=i[a],a,i))===h&&((h=!h)?c.lineStart():c.lineEnd()),h&&c.point(+e(o,a,i),+t(o,a,i));if(u)return c=null,u+""||null}return u.x=function(t){return arguments.length?(e="function"==typeof t?t:(0,i.Z)(+t),u):e},u.y=function(e){return arguments.length?(t="function"==typeof e?e:(0,i.Z)(+e),u):t},u.defined=function(e){return arguments.length?(n="function"==typeof e?e:(0,i.Z)(!!e),u):n},u.curve=function(e){return arguments.length?(s=e,null!=l&&(c=s(l)),u):s},u.context=function(e){return arguments.length?(null==e?l=c=null:c=s(l=e),u):l},u}},78260:function(e,t,n){"use strict";function r(e){return e[0]}function i(e){return e[1]}n.d(t,{x:function(){return r},y:function(){return i}})}}]);
//# sourceMappingURL=AltrpPieDiagram.13a07301418900e4d08f.bundle.js.map