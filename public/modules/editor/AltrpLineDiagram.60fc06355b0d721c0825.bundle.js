(self.webpackChunk=self.webpackChunk||[]).push([[8263],{10895:function(e,t,r){"use strict";r.d(t,{O:function(){return d}});var o=r(90484),a=r(92137),n=r(87757),l=r.n(n),i=r(9669),c=r.n(i),u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.keys(e).reduce((function(t,r,o){return[t,0===o?"?":"&",r=encodeURIComponent(r),"=",encodeURIComponent(e[r])].join("")}),"");return console.log("RESULT ==>",t),t},d=function(){var e=(0,a.Z)(l().mark((function e(t,r){var a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="","object"===(0,o.Z)(r)?a=u(r):void 0!==r&&(a=u(JSON.parse(r))),e.prev=2,e.next=5,c()(t+a,{});case 5:return e.abrupt("return",e.sent);case 8:return e.prev=8,e.t0=e.catch(2),console.log(e.t0),e.abrupt("return",{status:500});case 12:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t,r){return e.apply(this,arguments)}}()},26568:function(e,t,r){"use strict";var o=r(92137),a=r(28481),n=r(87757),l=r.n(n),i=r(67294),c=r(24549),u=r(65056),d=r(5367),s=r(23233),p=r(10895),v=r(30381),h=r.n(v),m=r(45250);m.Z;var f=_.find(s.Z,{value:"regagro"}).colors,k=_.find(s.Z,{value:"milk"}).colors,b=_.find(s.Z,{value:"milk2"}).colors,y="%d.%m.%Y";t.Z=function(e){var t=e.widget,r=e.width,n=void 0===r?"300px":r,s=e.height,v=void 0===s?"450px":s,g=e.margin,x=e.keyIsDate,M=e.dataSource,S=void 0===M?[]:M,C=e.lineWidth,E=void 0===C?2:C,w=e.pointSize,R=void 0===w?10:w,D=e.xScaleType,O=void 0===D?"point":D,Z=e.precision,P=void 0===Z?"month":Z,L=e.colorScheme,Y=void 0===L?"red_grey":L,I=e.curve,V=void 0===I?"linear":I,W=e.enableArea,j=void 0!==W&&W,N=e.enablePoints,B=void 0===N||N,A=e.pointColor,q=(e.yMarker,e.yMarkerValue,e.yMarkerOrientation,e.yMarkerColor,e.yMarkerLabel,e.yMarkerWidth,e.xMarker,e.xMarkerValue,e.xMarkerOrientation,e.xMarkerColor,e.xMarkerLabel,e.xMarkerWidth,e.yMarkerLabelColor,e.xMarkerLabelColor,e.sort),F=void 0===q?"":q,G=e.tickRotation,H=void 0===G?0:G,T=e.bottomAxis,z=void 0===T||T,X=e.enableGridX,U=void 0===X||X,J=e.enableGridY,K=void 0===J||J,Q=e.customColorSchemeChecker,$=void 0!==Q&&Q,ee=e.customColors,te=void 0===ee?[]:ee,re=e.constantsAxises,oe=void 0===re?[]:re,ae=e.yScaleMax,ne=e.widgetID,le=e.useCustomTooltips,ie=(0,i.useState)(!1),ce=(0,a.Z)(ie,2),ue=ce[0],de=ce[1],se=(0,i.useState)([]),pe=(0,a.Z)(se,2),ve=pe[0],he=pe[1],me=(0,i.useCallback)((0,o.Z)(l().mark((function e(){var r,o;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(de(!0),0!=S.length){e.next=8;break}return e.next=4,(0,p.O)(t.source,t.filter);case 4:200===(r=e.sent).status&&(o=r.data.data.map((function(e){var t=e.key,r=h()(t).isValid()?h()(t).format("DD.MM.YYYY"):t;return{y:Number(e.data),x:x?r:t}})),he([{id:"",data:o}]||[]),de(!1)),e.next=19;break;case 8:if(null===F||"undefined"===F||void 0===S){e.next=17;break}e.t0=F,e.next="value"===e.t0?12:"key"===e.t0?14:16;break;case 12:return S.forEach((function(e,t){e.data.length>0&&(S[t].data=_.sortBy(e.data,["y"]))})),e.abrupt("break",17);case 14:return ve.forEach((function(e,t){e.data.length>0&&(S[t].data=_.sortBy(e.data,["x"]))})),e.abrupt("break",17);case 16:return e.abrupt("break",17);case 17:he(S||[]),de(!1);case 19:case"end":return e.stop()}}),e)}))),[t]);return(0,i.useEffect)((function(){me()}),[me]),ue?i.createElement(u.Z,null):_.uniq(ve.map((function(e){return e.data.length>0}))).includes(!0)?i.createElement(i.Fragment,null,i.createElement("div",{style:{width:n,height:v}},i.createElement(c.fH,{data:ve,margin:{top:(null==g?void 0:g.top)||30,right:(null==g?void 0:g.right)||30,bottom:(null==g?void 0:g.bottom)||30,left:(null==g?void 0:g.left)||30},xFormat:"time"===O&&"time:%d.%m.%Y",yScale:ae?{max:ae,type:"linear"}:{type:"linear"},xScale:"time"===O?{type:O,format:y,precision:P}:{type:O},lineWidth:E,markers:oe,enableGridX:U,enableGridY:K,axisBottom:z&&("time"===O?{format:y,tickRotation:H}:{tickRotation:H}),useMesh:!0,enableArea:j,enablePoints:B,tooltip:function(e){return console.log("===================================="),console.log(e),console.log("===================================="),i.createElement(m.Z,{keyIsDate:x,datum:e,enable:le,widgetID:ne})},pointSize:R,curve:V,colors:$&&te.length>0?te:"regagro"===Y?f:"milk"===Y?k:"milk2"===Y?b:{scheme:Y},pointColor:null!=A?A.colorPickedHex:{from:"color",modifiers:[]}}))):i.createElement(d.Z,null)}},5367:function(e,t,r){"use strict";var o=r(67294);t.Z=function(e){var t=e.text;return o.createElement("div",{className:"spinner-container"},o.createElement("div",{className:"spinner-container__text"},t||"Данные обрабатываются"))}},65056:function(e,t,r){"use strict";var o=r(67294);t.Z=function(){return o.createElement("div",{className:"spinner-container"},o.createElement("div",{className:"spinner-border",style:{width:"3rem",height:"3rem"},role:"status"},o.createElement("span",{className:"sr-only"},"Загрузка...")))}},45250:function(e,t,r){"use strict";var o=r(96156),a=r(6610),n=r(5991),l=r(63349),i=r(10379),c=r(46070),u=r(77608);function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){(0,o.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var p=function(e){(0,i.Z)(d,e);var t,r,o=(t=d,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,o=(0,u.Z)(t);if(r){var a=(0,u.Z)(this).constructor;e=Reflect.construct(o,arguments,a)}else e=o.apply(this,arguments);return(0,c.Z)(this,e)});function d(e){var t;return(0,a.Z)(this,d),(t=o.call(this,e)).state={enablebar:e.datum.enable,enable:e.enable,point:e.datum.point,data:e.datum.point.data,settings:null==e?void 0:e.settings,keyIsDate:null==e?void 0:e.keyIsDate},t.containerSettings=t.containerSettings.bind((0,l.Z)(t)),t}return(0,n.Z)(d,[{key:"componentDidUpdate",value:function(e,t){var r=this;_.isEqual(e.datum.point,this.props.datum.point)||this.setState((function(e){return s(s({},e),{},{point:r.props.datum.point,data:r.props.datum.point.data})})),_.isEqual(e.settings,this.props.settings)||this.setState((function(e){var t;return s(s({},e),{},{settings:null===(t=r.props)||void 0===t?void 0:t.settings})})),_.isEqual(e.enable,this.props.enable)||this.setState((function(e){var t;return s(s({},e),{},{settenableings:null===(t=r.props)||void 0===t?void 0:t.enable})}))}},{key:"containerSettings",value:function(){var e,t,r,o,a,n=(null===(e=this.state)||void 0===e?void 0:e.settings)||{};return{padding:"".concat((null==n||null===(t=n.padding)||void 0===t?void 0:t.top)||5,"px ").concat((null==n||null===(r=n.padding)||void 0===r?void 0:r.right)||5,"px ").concat((null==n||null===(o=n.padding)||void 0===o?void 0:o.bottom)||5,"px ").concat((null==n||null===(a=n.padding)||void 0===a?void 0:a.left)||5,"px"),borderStyle:"".concat((null==n?void 0:n.borderStyle)||"solid"),borderRadius:"".concat((null==n?void 0:n.borderRadius)||"4px"),borderColor:"".concat((null==n?void 0:n.borderColor)||"black"),borderWidth:"".concat((null==n?void 0:n.borderWidth)||"1px"),backgroundColor:"".concat((null==n?void 0:n.backgroundColor)||"red"),color:"white",width:"fit-content",flexDirection:"column-reverse"}}},{key:"render",value:function(){var e,t,r;if(this.state.enable)return React.createElement(React.Fragment,null,React.createElement("div",{className:"".concat(this.props.widgetID," altrp-dashboard__tooltip--label-background altrp-dashboard__tooltip--width altrp-dashboard__tooltip--label-background-shadow altrp-dashboard__tooltip--border-type altrp-dashboard__tooltip--border-width altrp-dashboard__tooltip--border-color col-12"),style:{padding:"5px 9px"}},React.createElement("div",null,void 0===(null===(e=this.state.data)||void 0===e?void 0:e.tooltip)&&React.createElement("div",{style:{whiteSpace:"pre",display:"flex",alignItems:"center"}},React.createElement("span",{style:{display:"block",width:"12px",height:"12px",background:this.state.point.color,marginRight:"7px"}}),React.createElement("div",{className:"".concat(this.props.widgetID," altrp-dashboard__tooltip--font col px-0")},this.props.keyIsDate?this.state.data.xFormatted:this.state.data.x,":",React.createElement("strong",{className:"".concat(this.props.widgetID," altrp-dashboard__tooltip--font col px-0")},this.state.data.y))),null===(t=this.state.data)||void 0===t||null===(r=t.tooltip)||void 0===r?void 0:r.map((function(e,t){return React.createElement(React.Fragment,null,React.createElement("div",{style:{color:(null==e?void 0:e.color)||"#000000"},key:t},"".concat(null==e?void 0:e.label,":"),React.createElement("strong",null,e.value)))})))));var o=this.state.data,a=o.xFormatted,n=o.yFormatted;return React.createElement(React.Fragment,null,React.createElement("div",{style:{background:"white",color:"inherit",fontSize:"{{SIZE}}px",borderRadius:"2px",boxShadow:"rgba(0, 0, 0, 0.25) 0px 1px 2px",padding:"5px 9px"}},React.createElement("div",{style:{whiteSpace:"pre",display:"flex",alignItems:"center"}},React.createElement("span",{style:{display:"block",width:"12px",height:"12px",background:this.state.point.color,marginRight:"7px"}}),React.createElement("span",null,a,": ",React.createElement("strong",null,n)))))}}]),d}(r(67294).PureComponent);t.Z=p},45438:function(e,t,r){"use strict";r.r(t);var o=r(67294),a=r(86817),n=r(14494),l=r(26568),i=r(23233),c=r(18354),u=r(30381),d=r.n(u);t.default=(0,n.connect)((function(e){return{currentDataStorage:e.currentDataStorage}}))((function(e){var t,r,u,s,p,v,h,m,f,k=e.settings,b=e.id,y=(0,n.useDispatch)(),g=null==k?void 0:k.margin,x=(null==k?void 0:k.widget_name)||b,M=null==k?void 0:k.isCustomColor,S=null==k||null===(t=k.customScheme)||void 0===t?void 0:t.map((function(e){return _.get(e,"color.colorPickedHex")})),C=null==k?void 0:k.yScaleMax,E=null==k?void 0:k.axisY,w=null==k||null===(r=k.repTooltips)||void 0===r?void 0:r.map((function(e){var t;return{label:_.get(e,"label"),field:_.get(e,"value"),color:null===(t=_.get(e,"color"))||void 0===t?void 0:t.colorPickedHex}})),R=null==k?void 0:k.customTooltip,D=(null==E?void 0:E.map((function(e){var t=(0,c.getDataByPath)(e.yMarkerValue);return{axis:"y",value:Number(null!==t?t:e.yMarkerValue),lineStyle:{stroke:null!=e.yMarkerColor?e.yMarkerColor.colorPickedHex:"#000000",strokeWidth:e.yMarkerWidth},textStyle:{fill:null!=e.yMarkerLabelColor?e.yMarkerLabelColor.colorPickedHex:"#000000"},legend:e.yMarkerLabel,legendOrientation:e.yMarkerOrientation}})))||[],O=null==k?void 0:k.axisX,Z=(null==O?void 0:O.map((function(e){var t=(0,c.getDataByPath)(e.xMarkerValue);return{axis:"x",value:null!==t?t:e.xMarkerIsDate?d()(e.xMarkerValue).format("DD.MM.YYYY"):e.xMarkerValue,lineStyle:{stroke:null!=e.xMarkerColor?e.xMarkerColor.colorPickedHex:"#000000",strokeWidth:e.xMarkerWidth},textStyle:{fill:null!=e.xMarkerLabelColor?e.xMarkerLabelColor.colorPickedHex:"#000000"},legend:e.xMarkerLabel,legendOrientation:e.xMarkerOrientation}})))||[],P=[];Z.length>0&&(P.push(Z),P=P.flat()),D.length>0&&(P.push(D),P=P.flat());var L=null===(u=k.query)||void 0===u||null===(s=u.dataSource)||void 0===s?void 0:s.value,Y=k.isMultiple,I=k.isCustomColors,V=k.key_is_date,W=null==k?void 0:k.sort,j=null==k?void 0:k.tickRotation,N=null==k?void 0:k.bottomAxis,B=null==k?void 0:k.enableGridX,A=null==k?void 0:k.enableGridY,q=(null==k?void 0:k.xScaleType)||"point",F=(null==k?void 0:k.precision)||"month",G=(null==k?void 0:k.curve)||"line",H=null==k?void 0:k.lineWidth,T=null==k?void 0:k.colorScheme,z=null==k?void 0:k.enableArea,X=null==k?void 0:k.enablePoints,U=null==k?void 0:k.pointSize,J=null==k?void 0:k.pointColor,K=null==k?void 0:k.yMarker,Q=null==k?void 0:k.yMarkerValue,$=null==k?void 0:k.yMarkerOrientation,ee=null==k?void 0:k.yMarkerColor,te=null==k?void 0:k.yMarkerWidth,re=null==k?void 0:k.yMarkerLabel,oe=null==k?void 0:k.yMarkerLabelColor,ae=null==k?void 0:k.xMarker,ne=V?d()(null==k?void 0:k.xMarkerValueDate).toDate():null==k?void 0:k.xMarkerValue,le=null==k?void 0:k.xMarkerOrientation,ie=null==k?void 0:k.xMarkerColor,ce=null==k?void 0:k.xMarkerWidth,ue=null==k?void 0:k.xMarkerLabel,de=null==k?void 0:k.xMarkerLabelColor,se=[],pe=function(e,t){return e.map((function(e,r){var o=_.get(e,t.key),a=d()(o).isValid()?d()(o).format("DD.MM.YYYY"):o,n=void 0!==w?null==w?void 0:w.map((function(t){return{label:null==t?void 0:t.label,value:_.get(e,t.field),color:null==t?void 0:t.color}})):[];return{y:Number(_.get(e,t.data)),x:V?a:o,tooltip:n}}))},ve=[],he=I?S:_.find(i.Z,{value:null==k?void 0:k.colorScheme}).colors,me=he.length;if((0,c.isEditor)())se=[{data:[{x:"2020-01",y:60},{x:"2020-02",y:200},{x:"2013-03",y:20},{x:"2013-04",y:10},{x:"2013-05",y:50}],id:"Line 1"},{data:[{x:"2020-01",y:50},{x:"2020-02",y:140},{x:"2013-03",y:40},{x:"2013-04",y:20},{x:"2013-05",y:60}],id:"Line 2"}];else if(Y)se=_.cloneDeep(k.rep,[]).map((function(e,t){var r=(0,c.getDataByPath)(e.path,[]);return r.length>0&&(r=_.uniqBy(r,e.key),r=pe(r,e)),ve.push({color:he[t%me],label:e.title||e.path}),{id:e.title||e.path,data:r}}));else if(null!=k.datasource_path)try{se=(0,c.getDataByPath)(k.datasource_path,[]),se=_.uniqBy(se,k.key_name);var fe={key:k.key_name,data:k.data_name};ve.push({color:he[0],label:k.datasource_title||k.datasource_path}),se=[{id:k.datasource_title||k.datasource_path,data:pe(se,fe)}]}catch(e){console.log("===================================="),console.error(e),console.log("===================================="),se=[{id:k.datasource_title||k.datasource_path,data:[]}]}if(!L&&0===se.length)return o.createElement("div",{className:"altrp-chart ".concat(k.legendPosition)},"Идет загрузка данных...");var ke={source:L+function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!e)return"";var t=e.split("\n"),r=t.map((function(e){return e.replace("|","=")})).join("&");return"?".concat(r)}(null===(p=k.query)||void 0===p?void 0:p.defaultParams),options:{colorScheme:k.colorScheme,legend:k.legend,animated:k.animated,isVertical:k.isVertical},filter:{}};return(0,o.useEffect)((function(){ve.length>0&&function(e){y((0,a.Xe)(x,{legend:e}))}(ve)}),[ve]),console.log("===================================="),console.log(se),console.log("===================================="),o.createElement(l.Z,{widgetID:b,margin:g,useCustomTooltips:R,yScaleMax:C,customColorSchemeChecker:M,customColors:S,widget:ke,dataSource:se,keyIsDate:V,xScaleType:q,precision:F,curve:G,colorScheme:T,enableArea:z,enablePoints:X,lineWidth:H,pointColor:J,pointSize:U,yMarker:K,width:"".concat(null===(v=k.width)||void 0===v?void 0:v.size).concat(null===(h=k.width)||void 0===h?void 0:h.unit),height:"".concat(null===(m=k.height)||void 0===m?void 0:m.size).concat(null===(f=k.height)||void 0===f?void 0:f.unit),yMarkerValue:Q,yMarkerOrientation:$,yMarkerColor:ee,yMarkerWidth:te,yMarkerLabel:re,xMarker:ae,xMarkerValue:ne,xMarkerOrientation:le,xMarkerColor:ie,xMarkerWidth:ce,xMarkerLabel:ue,yMarkerLabelColor:oe,xMarkerLabelColor:de,constantsAxises:P,sort:W,tickRotation:j,bottomAxis:N,enableGridX:B,enableGridY:A})}))},93072:function(e,t,r){"use strict";function o(e){return function(){return e}}r.d(t,{Z:function(){return o}})}}]);
//# sourceMappingURL=AltrpLineDiagram.60fc06355b0d721c0825.bundle.js.map