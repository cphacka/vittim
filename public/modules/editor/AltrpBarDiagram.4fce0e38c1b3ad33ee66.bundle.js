(self.webpackChunk=self.webpackChunk||[]).push([[7696],{10895:function(e,t,r){"use strict";r.d(t,{O:function(){return d}});var o=r(90484),n=r(92137),l=r(87757),a=r.n(l),i=r(9669),u=r.n(i),c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.keys(e).reduce((function(t,r,o){return[t,0===o?"?":"&",r=encodeURIComponent(r),"=",encodeURIComponent(e[r])].join("")}),"");return console.log("RESULT ==>",t),t},d=function(){var e=(0,n.Z)(a().mark((function e(t,r){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="","object"===(0,o.Z)(r)?n=c(r):void 0!==r&&(n=c(JSON.parse(r))),e.prev=2,e.next=5,u()(t+n,{});case 5:return e.abrupt("return",e.sent);case 8:return e.prev=8,e.t0=e.catch(2),console.log(e.t0),e.abrupt("return",{status:500});case 12:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t,r){return e.apply(this,arguments)}}()},5367:function(e,t,r){"use strict";var o=r(67294);t.Z=function(e){var t=e.text;return o.createElement("div",{className:"spinner-container"},o.createElement("div",{className:"spinner-container__text"},t||"Данные обрабатываются"))}},65056:function(e,t,r){"use strict";var o=r(67294);t.Z=function(){return o.createElement("div",{className:"spinner-container"},o.createElement("div",{className:"spinner-border",style:{width:"3rem",height:"3rem"},role:"status"},o.createElement("span",{className:"sr-only"},"Загрузка...")))}},22683:function(e,t,r){"use strict";var o=r(96156),n=r(6610),l=r(5991),a=r(10379),i=r(46070),u=r(77608),c=r(67294);function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){(0,o.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var v=function(e){(0,a.Z)(d,e);var t,r,o=(t=d,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,o=(0,u.Z)(t);if(r){var n=(0,u.Z)(this).constructor;e=Reflect.construct(o,arguments,n)}else e=o.apply(this,arguments);return(0,i.Z)(this,e)});function d(e){var t,r,l,a;return(0,n.Z)(this,d),(a=o.call(this,e)).state={indexValue:null===(t=e.datum)||void 0===t?void 0:t.indexValue,value:null===(r=e.datum)||void 0===r?void 0:r.value,color:null===(l=e.datum)||void 0===l?void 0:l.color,enable:null==e?void 0:e.enable,settings:null==e?void 0:e.settings},a}return(0,l.Z)(d,[{key:"componentDidUpdate",value:function(e,t){var r=this;_.isEqual(e.enable,this.props.enable)||this.setState((function(e){var t;return s(s({},e),{},{enable:null===(t=r.props)||void 0===t?void 0:t.enable})}))}},{key:"render",value:function(){var e,t,r,o;return this.state.enable?c.createElement("div",{className:"".concat(this.props.widgetID," altrp-dashboard__tooltip--font altrp-dashboard__tooltip--label-background altrp-dashboard__tooltip--width altrp-dashboard__tooltip--label-background-shadow altrp-dashboard__tooltip--border-type altrp-dashboard__tooltip--border-width altrp-dashboard__tooltip--border-color col-12"),style:{padding:"5px 9px"}},c.createElement("div",null,c.createElement("div",{style:{color:"white",display:"flex"}},c.createElement("div",{style:{height:"100%",display:"flex",alignItems:"center"}},c.createElement("div",{style:{width:"15px",height:"15px",background:this.props.datum.datum.color||"#000000",marginRight:"3px",marginTop:"1px"}})),null===(e=this.props.datum)||void 0===e||null===(t=e.datum)||void 0===t?void 0:t.label,":",c.createElement("strong",null,null===(r=this.props.datum)||void 0===r||null===(o=r.datum)||void 0===o?void 0:o.value)))):c.createElement(c.Fragment,null,c.createElement("div",{style:{background:"white",color:"inherit",fontSize:"{{SIZE}}px",borderRadius:"2px",boxShadow:"rgba(0, 0, 0, 0.25) 0px 1px 2px",padding:"5px 9px"}},c.createElement("div",{style:{whiteSpace:"pre",display:"flex",alignItems:"center"}},c.createElement("span",{style:{display:"block",width:"12px",height:"12px",background:this.props.datum.datum.color,marginRight:"7px"}}),c.createElement("span",null,this.props.datum.datum.label,":"," ",c.createElement("strong",null,this.props.datum.datum.value)))))}}]),d}(c.PureComponent);t.Z=v},78906:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return S}});var o=r(85061),n=r(96156),l=r(67294),a=r(86817),i=r(14494),u=r(28481),c=r(87757),d=r.n(c),s=r(65056),v=r(5367),p=r(23233),m=r(58965),h=r(10895),f=r(22683),b=_.find(p.Z,{value:"regagro"}).colors,g=_.find(p.Z,{value:"milk"}).colors,y=_.find(p.Z,{value:"milk2"}).colors,k=f.Z,x=function(e){var t=e.widget,r=e.width,o=void 0===r?300:r,a=e.height,i=void 0===a?450:a,c=e.margin,p=e.dataSource,f=void 0===p?[]:p,x=e.groupMode,w=void 0===x?"stacked":x,M=e.layout,E=void 0===M?"vertical":M,S=e.colorScheme,Z=void 0===S?"regagro":S,O=e.reverse,C=void 0!==O&&O,P=e.enableLabel,D=void 0!==P&&P,R=e.padding,j=void 0===R?.1:R,N=e.innerPadding,Y=void 0===N?0:N,L=e.borderRadius,B=void 0===L?0:L,I=e.borderWidth,V=void 0===I?0:I,G=e.sort,W=void 0===G?"":G,H=e.tickRotation,T=void 0===H?0:H,X=(e.bottomAxis,e.enableGridX),z=void 0===X||X,U=e.enableGridY,q=void 0===U||U,A=e.customColorSchemeChecker,F=void 0!==A&&A,J=e.customColors,K=void 0===J?[]:J,Q=(e.yScaleMax,e.widgetID),$=e.useCustomTooltips,ee=(0,l.useState)(!1),te=(0,u.Z)(ee,2),re=te[0],oe=te[1],ne=(0,l.useState)([]),le=(0,u.Z)(ne,2),ae=le[0],ie=le[1],ue=(0,l.useCallback)((function(){return e=void 0,r=void 0,o=void 0,l=d().mark((function e(){var r,o;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(oe(!0),0!=f.length){e.next=8;break}return e.next=4,(0,h.O)(t.source,t.filter);case 4:200===(r=e.sent).status&&(o=r.data.data.map((function(e,t){var r;return r={},(0,n.Z)(r,e.key,Number(e.data)),(0,n.Z)(r,"key",e.key),(0,n.Z)(r,"value",Number(e.data)),r})),ie(o||[]),oe(!1)),e.next=20;break;case 8:if(null==W||void 0===f){e.next=18;break}e.t0=W,e.next="value"===e.t0?12:"key"===e.t0?14:16;break;case 12:return f=_.sortBy(f,["value"]),e.abrupt("break",18);case 14:return f=_.sortBy(f,["key"]),e.abrupt("break",18);case 16:return f=f,e.abrupt("break",18);case 18:ie(f||[]),oe(!1);case 20:case"end":return e.stop()}}),e)})),new(o||(o=Promise))((function(t,n){function a(e){try{u(l.next(e))}catch(e){n(e)}}function i(e){try{u(l.throw(e))}catch(e){n(e)}}function u(e){var r;e.done?t(e.value):(r=e.value,r instanceof o?r:new o((function(e){e(r)}))).then(a,i)}u((l=l.apply(e,r||[])).next())}));var e,r,o,l}),[t]);return(0,l.useEffect)((function(){ue()}),[ae]),re?l.createElement(s.Z,null):0===ae.length?l.createElement(v.Z,null):l.createElement(l.Fragment,null,l.createElement("div",{style:{height:"".concat(i),width:"".concat(o)}},l.createElement(m.jM,{data:ae,margin:{top:(null==c?void 0:c.top)||30,right:(null==c?void 0:c.right)||30,bottom:(null==c?void 0:c.bottom)||30,left:(null==c?void 0:c.left)||30},indexBy:"key",colors:F&&K.length>0?K:"regagro"===Z?b:"milk"===Z?g:"milk2"===Z?y:{scheme:Z},layout:E,tooltip:function(e){return l.createElement(k,{enable:$,datum:e,widgetID:Q})},enableGridX:z,enableGridY:q,enableLabel:D,reverse:C,groupMode:w,padding:j,innerPadding:Y,borderRadius:B,borderWidth:V,axisBottom:{tickSize:5,tickPadding:5,tickRotation:T,legendOffset:32}})))},w=r(18354),M=r(30381),E=r.n(M),S=(0,i.connect)((function(e){return{currentDataStorage:e.currentDataStorage}}))((function(e){var t,r,u,c,d,s,v,m,h,f=e.settings,b=e.id,g=(0,i.useDispatch)(),y=null==f?void 0:f.margin,k=(null==f?void 0:f.widget_name)||b,M=null==f?void 0:f.isCustomColor,S=null==f||null===(t=f.customScheme)||void 0===t?void 0:t.map((function(e){return _.get(e,"color.colorPickedHex")})),Z=null==f?void 0:f.yScaleMax,O=null==f?void 0:f.axisY,C=null==f||null===(r=f.repTooltips)||void 0===r?void 0:r.map((function(e){var t;return{label:_.get(e,"label"),field:_.get(e,"value"),color:null===(t=_.get(e,"color"))||void 0===t?void 0:t.colorPickedHex}})),P=null==f?void 0:f.customTooltip,D=(null==O?void 0:O.map((function(e){var t=(0,w.getDataByPath)(e.yMarkerValue);return{axis:"y",value:Number(null!==t?t:e.yMarkerValue),lineStyle:{stroke:null!=e.yMarkerColor?e.yMarkerColor.colorPickedHex:"#000000",strokeWidth:e.yMarkerWidth},textStyle:{fill:null!=e.yMarkerLabelColor?e.yMarkerLabelColor.colorPickedHex:"#000000"},legend:e.yMarkerLabel,legendOrientation:e.yMarkerOrientation}})))||[],R=null==f?void 0:f.axisX,j=(null==R?void 0:R.map((function(e){var t=(0,w.getDataByPath)(e.xMarkerValue);return{axis:"x",value:null!==t?t:e.xMarkerIsDate?E()(e.xMarkerValue).format("DD.MM.YYYY"):e.xMarkerValue,lineStyle:{stroke:null!=e.xMarkerColor?e.xMarkerColor.colorPickedHex:"#000000",strokeWidth:e.xMarkerWidth},textStyle:{fill:null!=e.xMarkerLabelColor?e.xMarkerLabelColor.colorPickedHex:"#000000"},legend:e.xMarkerLabel,legendOrientation:e.xMarkerOrientation}})))||[],N=[];j.length>0&&(N.push(j),N=N.flat()),D.length>0&&(N.push(D),N=N.flat());var Y,L,B=null===(u=f.query)||void 0===u||null===(c=u.dataSource)||void 0===c?void 0:c.value,I=f.isMultiple,V=f.isCustomColors,G=f.key_is_date,W=null==f?void 0:f.sort,H=null==f?void 0:f.tickRotation,T=null==f?void 0:f.bottomAxis,X=null==f?void 0:f.enableGridX,z=null==f?void 0:f.enableGridY,U=null==f?void 0:f.colorScheme,q=null==f?void 0:f.layout,A=null==f?void 0:f.groupMode,F=null==f?void 0:f.reverse,J=null==f?void 0:f.borderRadius,K=null==f?void 0:f.borderWidth,Q=null==f?void 0:f.enableLabel,$=null==f?void 0:f.padding,ee=[],te=function(e,t){return e.map((function(e,r){var o,l=_.get(e,t.key),a=E()(l).isValid()?E()(l).format("DD.MM.YYYY"):l,i=void 0!==C?null==C?void 0:C.map((function(t){return{label:null==t?void 0:t.label,value:_.get(e,t.field),color:null==t?void 0:t.color}})):[],u=G?a:l;return o={},(0,n.Z)(o,u,Number(_.get(e,t.data))),(0,n.Z)(o,"key",u),(0,n.Z)(o,"value",Number(_.get(e,t.data))),(0,n.Z)(o,"tooltip",i),o}))},re=[],oe=V?S:_.find(p.Z,{value:null==f?void 0:f.colorScheme}).colors;if((0,w.isEditor)())ee=[{key:"title",value:60,title:60,tooltip:[]},{key:"title1",value:40,title:40,tooltip:[]}];else if(I)ee=_.cloneDeep(f.rep,[]).map((function(e,t){var r=(0,w.getDataByPath)(e.path,[]);return r.length>0&&(r=te(r,e)),r})),ee=(Y=[]).concat.apply(Y,(0,o.Z)(ee)),re=null===(L=ee)||void 0===L?void 0:L.map((function(e,t){return{color:oe[0],label:e.id||e.key}}));else if(null!=f.datasource_path)try{var ne;ee=(0,w.getDataByPath)(f.datasource_path,[]);var le={key:f.key_name,data:f.data_name};ee=te(ee,le),re=null===(ne=ee)||void 0===ne?void 0:ne.map((function(e,t){return{color:oe[0],label:e.id||e.key}}))}catch(e){console.log("===================================="),console.error(e),console.log("===================================="),ee=[{id:f.datasource_title||f.datasource_path,data:[]}]}if(!B&&0===ee.length)return l.createElement("div",{className:"altrp-chart ".concat(f.legendPosition)},"Идет загрузка данных...");var ae={source:B+function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!e)return"";var t=e.split("\n"),r=t.map((function(e){return e.replace("|","=")})).join("&");return"?".concat(r)}(null===(d=f.query)||void 0===d?void 0:d.defaultParams),options:{colorScheme:f.colorScheme,legend:f.legend,animated:f.animated,isVertical:f.isVertical},filter:{}};return(0,l.useEffect)((function(){re.length>0&&function(e){g((0,a.Xe)(k,{legend:e}))}(re)}),[re]),console.log("===================================="),console.log(ee),console.log("===================================="),l.createElement(x,{widgetID:b,margin:y,useCustomTooltips:P,yScaleMax:Z,customColorSchemeChecker:M,customColors:S,isMultiple:I,colorScheme:U,dataSource:ee,widget:ae,enableLabel:Q,width:"".concat(null===(s=f.width)||void 0===s?void 0:s.size).concat(null===(v=f.width)||void 0===v?void 0:v.unit),height:"".concat(null===(m=f.height)||void 0===m?void 0:m.size).concat(null===(h=f.height)||void 0===h?void 0:h.unit),layout:q,groupMode:A,reverse:F,borderRadius:J,borderWidth:K,padding:$,sort:W,tickRotation:H,bottomAxis:T,enableGridX:X,enableGridY:z})}))}}]);
//# sourceMappingURL=AltrpBarDiagram.4fce0e38c1b3ad33ee66.bundle.js.map