(self.webpackChunk=self.webpackChunk||[]).push([[1720],{80955:function(t,e,r){"use strict";r.r(e),r.d(e,{default:function(){return f}});var s=r(6610),n=r(5991),a=r(92137),i=r(87757),o=r.n(i),u=r(38773),c=r(15272),l=r(18354),d=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"POST",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};(0,s.Z)(this,t),this.formId=e,this.fields=[],this.submitButtons=[],this.method=n,this.options=a,this.modelName=r;var i="/ajax/models/".concat(r),o=this.options,c=o.dynamicURL,l=o.customRoute;switch(r){case"login":i="/login";break;case"logout":i="/logout";break;case"email":i="/ajax/feedback"}l&&(i=l),this.resource=new u.default({route:i,dynamicURL:c})}var e;return(0,n.Z)(t,[{key:"setFields",value:function(t){this.fields=t}},{key:"addSubmitButton",value:function(t){this.submitButtons.push(t)}},{key:"addField",value:function(t){var e=!1;return this.fields=this.fields.map((function(r){return r.getId()===t.getId()?(e=!0,t.component?t:r):r})),e||this.fields.push(t),!0}},{key:"submit",value:(e=(0,a.Z)(o().mark((function t(){var e,s,n,a,i,u,c,d,h,f=this,g=arguments;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=g.length>0&&void 0!==g[0]?g[0]:null,s=g.length>1&&void 0!==g[1]?g[1]:"",n=g.length>2&&void 0!==g[2]?g[2]:null,a=g.length>3&&void 0!==g[3]?g[3]:null,i=!0,!s){t.next=11;break}return t.next=8,confirm(s);case 8:if(t.sent){t.next=11;break}return t.abrupt("return",{success:!1});case 11:if(this.fields.forEach((function(t){t.fieldValidate()||(i=!1)})),!i){t.next=71;break}t.prev=13,t.t0=this.method,t.next="POST"===t.t0?17:"PUT"===t.t0?32:"GET"===t.t0?41:"DELETE"===t.t0?46:52;break;case 17:return t.next=19,this.resource.post(_.assign(this.getData(),n),a);case 19:if(u=t.sent,"login"!==this.modelName||!this.options.afterLoginRedirect){t.next=23;break}return document.location.replace(this.options.afterLoginRedirect),t.abrupt("return",u);case 23:if("logout"!==this.modelName||!this.options.afterLogoutRedirect){t.next=26;break}return document.location.replace(this.options.afterLogoutRedirect),t.abrupt("return",u);case 26:if(!u.reload){t.next=29;break}return document.location.reload(),t.abrupt("return");case 29:return this.clearInputs(),this.updateResponseStorage(u),t.abrupt("return",u);case 32:if(!e&&!this.options.customRoute){t.next=39;break}return t.next=35,this.resource.put(e,_.assign(this.getData(),n),a);case 35:return c=t.sent,Promise.resolve().then(r.bind(r,75098)).then((function(t){t.default.updateModelWithData(f.modelName,e,f.getData())})),this.updateResponseStorage(c),t.abrupt("return",c);case 39:return console.error("Не удалось получить ИД модели для обновления или customRoute!"),t.abrupt("break",52);case 41:return t.next=43,this.resource.getQueried(_.assign(this.getData(),n),a);case 43:return d=t.sent,this.updateResponseStorage(d),t.abrupt("return",d);case 46:if(!e&&!this.options.customRoute){t.next=50;break}return t.next=49,this.resource.delete(e,_.assign(this.getData(),n),a);case 49:return t.abrupt("return",t.sent);case 50:return console.error("Не удалось получить ИД модели для удаления или customRoute!"),t.abrupt("break",52);case 52:t.next=67;break;case 54:if(t.prev=54,t.t1=t.catch(13),h=t.t1.status,t.t1.res instanceof Promise&&(t.t1=t.t1.res),!(t.t1 instanceof Promise)){t.next=66;break}return t.next=61,t.t1.then();case 61:t.t1=t.sent,t.t1=(0,l.mbParseJSON)(t.t1,t.t1),t.t1.data&&(t.t1=t.t1.data),h&&(t.t1.data?t.t1.data.__status=h:t.t1.__status=h),this.updateResponseStorage(t.t1);case 66:return t.abrupt("return",{success:!1,error:t.t1});case 67:return t.prev=67,t.finish(67);case 69:t.next=74;break;case 71:return t.next=73,alert("Пожалуйста, заполните все обязательные поля");case 73:return t.abrupt("return",{success:!1});case 74:case"end":return t.stop()}}),t,this,[[13,54,67,69]])}))),function(){return e.apply(this,arguments)})},{key:"clearInputs",value:function(){this.fields.forEach((function(t){try{_.isFunction(_.get(t,"component.setState"))}catch(t){console.error(t)}}))}},{key:"getData",value:function(){var t={altrp_ajax:!0};if("email"===this.modelName){var e="",r="Altrp Email";this.submitButtons.forEach((function(t){t.getSettings("email_subject")&&(r=t.getSettings("email_subject"))})),this.fields.forEach((function(t){if(null!==t.getValue()){var r=t.getSettings("content_label")||t.getSettings("content_placeholder")||"",s=t.getValue();e+="".concat(r,": ").concat(s," <br/> ")}})),t.subject=r,t.user_message=e}else this.fields.forEach((function(e){switch(e.getName()){case"input-date-range":var r=e.getSettings("field_id_start"),s=e.getSettings("field_id_end"),n=e.getValue();t[r]=n[0],t[s]=n[1];break;default:t[e.getFieldId()]=e.getValue()}}));return t}},{key:"updateResponseStorage",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};appStore.dispatch((0,c.Nb)(this.formId,t))}}]),t}(),h=function(){function t(){(0,s.Z)(this,t),this.forms=[],this.formIds=[],this.fieldsStorage={}}return(0,n.Z)(t,[{key:"registerForm",value:function(t,e,r){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=this.getForm(t);return n?_.isEmpty(s)||(n.options=s):(n=new d(t,e,r,s),this.fieldsStorage[t]&&this.fieldsStorage[t].length&&(n.setFields(this.fieldsStorage[t]),delete this.fieldsStorage[t]),this.forms.push(n)),n}},{key:"deleteFormById",value:function(t){this.forms=this.forms.filter((function(e){return e.formId!==t}))}},{key:"addField",value:function(t,e){var r=this.getForm(t);return r?r.addField(e):(this.fieldsStorage[t]=this.fieldsStorage[t]||[],this.fieldsStorage[t].push(e),!0)}},{key:"clearFieldsStorage",value:function(){this.fieldsStorage={}}},{key:"submitForm",value:function(t,e){return this.getForm(t)?this.getForm(t).submit(e):(console.error("Форма не найдена"),!1)}},{key:"getForm",value:function(t){var e=null;return this.forms.forEach((function(r){r.formId===t&&(e=r)})),e}},{key:"clearFormsStore",value:function(){this.forms=[]}}]),t}();window.formsManager=new h;var f=window.formsManager}}]);
//# sourceMappingURL=FormsManager.6722fa64bd55331d5c75.bundle.js.map