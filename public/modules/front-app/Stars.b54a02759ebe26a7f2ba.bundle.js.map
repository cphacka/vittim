{"version":3,"sources":["webpack:///./node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js","webpack:///./node_modules/@babel/runtime/helpers/esm/defineProperty.js","webpack:///./node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js","webpack:///./node_modules/@babel/runtime/helpers/esm/inherits.js","webpack:///./node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js","webpack:///./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack:///./node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js","webpack:///./node_modules/@babel/runtime/helpers/esm/typeof.js","webpack:///./resources/modules/editor/src/js/components/widgets/StarsWidget.js","webpack:///./resources/modules/front-app/src/js/store/forms-data-storage/actions.js"],"names":["_assertThisInitialized","self","ReferenceError","_defineProperty","obj","key","value","Object","defineProperty","enumerable","configurable","writable","_getPrototypeOf","o","setPrototypeOf","getPrototypeOf","__proto__","_inherits","subClass","superClass","TypeError","prototype","create","constructor","_possibleConstructorReturn","call","_setPrototypeOf","p","_taggedTemplateLiteral","strings","raw","slice","freeze","defineProperties","_typeof","Symbol","iterator","EmptyStarInitial","StarInitial","StarsList","styled","ul","Star","li","EmptyStarIcon","StarIcon","window","altrpHelpers","isEditor","replaceContentWithData","getDataByPath","StarsWidget","props","dispatchFieldValueToStore","userInput","formId","element","getFormId","fieldName","getFieldId","indexOf","_","isObject","appStore","dispatch","changeFormFieldValue","change_actions","getSettings","actionsManager","default","callAllWidgetActions","getIdForAction","getValue","state","get","getState","formsStore","component","elementDecorator","baseRender","render","settings","defaultValue","getContent","isNaN","parseInt","changed","handleClick","bind","idx","this","setState","s","previousProps","previousState","default_value","countNumber","size","count","Array","fill","visualValue","className","map","active","onClick","acitve","Component","CHANGE_FORM_FIELD_VALUE","CLEAR_FORM_FIELD_VALUE","type","changedField"],"mappings":"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","file":"Stars.b54a02759ebe26a7f2ba.bundle.js","sourcesContent":["export default function _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}","export default function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}","export default function _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) setPrototypeOf(subClass, superClass);\n}","import _typeof from \"@babel/runtime/helpers/typeof\";\nimport assertThisInitialized from \"./assertThisInitialized.js\";\nexport default function _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return assertThisInitialized(self);\n}","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}","export default function _taggedTemplateLiteral(strings, raw) {\n  if (!raw) {\n    raw = strings.slice(0);\n  }\n\n  return Object.freeze(Object.defineProperties(strings, {\n    raw: {\n      value: Object.freeze(raw)\n    }\n  }));\n}","export default function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}","import React from \"react\";\r\nimport EmptyStarInitial from \"../../../svgs/empty-star.svg\";\r\nimport StarInitial from \"../../../svgs/star.svg\";\r\nimport {changeFormFieldValue} from \"../../../../../front-app/src/js/store/forms-data-storage/actions\";\r\n\r\nconst StarsList = styled.ul`\r\n  list-style-type: none;\r\n  margin: 0;\r\n  padding: 0;\r\n  display: flex;\r\n\r\n`\r\n\r\nconst Star = styled.li`\r\n  cursor: pointer;\r\n\r\n  & svg {\r\n    transition: none\r\n  }\r\n`\r\n\r\nconst EmptyStarIcon = styled(EmptyStarInitial)`\r\n\r\n`;\r\n\r\nconst StarIcon = styled(StarInitial)`\r\n`;\r\n\r\nconst {isEditor, getDataByPath, replaceContentWithData} = window.altrpHelpers\r\n\r\nclass StarsWidget extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    props.element.component = this;\r\n\r\n    if (window.elementDecorator) {\r\n      window.elementDecorator(this);\r\n    }\r\n    if(props.baseRender){\r\n      this.render = props.baseRender(this);\r\n    }\r\n\r\n    const settings = props.element.getSettings();\r\n\r\n    let defaultValue = this.getContent(\r\n      \"default_value\"\r\n    );\r\n\r\n    if(!isNaN(defaultValue)) {\r\n      defaultValue = _.parseInt(defaultValue) || -1;\r\n    } else {\r\n      defaultValue = -1\r\n    }\r\n\r\n    this.state = {\r\n      settings,\r\n      value: defaultValue,\r\n      changed: false,\r\n    };\r\n\r\n    this.dispatchFieldValueToStore(defaultValue || 0);\r\n\r\n    this.handleClick = this.handleClick.bind(this);\r\n  }\r\n\r\n  handleClick(idx) {\r\n    let value = idx+1;\r\n\r\n    if(this.state.value === value) {\r\n      value = 0\r\n    }\r\n\r\n    this.setState((s) => ({\r\n      ...s,\r\n      changed: true,\r\n      value\r\n    }), () => {\r\n      this.dispatchFieldValueToStore(value, true)\r\n    });\r\n  }\r\n\r\n  _componentDidUpdate(previousProps, previousState) {\r\n    if(this.state.settings.default_value !== previousState.settings.default_value) {\r\n      let defaultValue = this.getContent(\r\n        \"default_value\"\r\n      );\r\n\r\n      if(!isNaN(defaultValue)) {\r\n        defaultValue = _.parseInt(defaultValue) || -1;\r\n      } else {\r\n        defaultValue = -1\r\n      }\r\n\r\n      this.setState((s) => ({\r\n        ...s,\r\n        value: defaultValue\r\n      }))\r\n\r\n      this.dispatchFieldValueToStore(defaultValue || 0);\r\n\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Передадим значение в хранилище формы\r\n   * @param {*} value\r\n   * @param {boolean} userInput true - имзенилось пользователем\r\n   */\r\n  dispatchFieldValueToStore = async (value, userInput = false) => {\r\n    let formId = this.props.element.getFormId();\r\n    let fieldName = this.props.element.getFieldId();\r\n    if (fieldName.indexOf(\"{{\") !== -1) {\r\n      fieldName = replaceContentWithData(fieldName);\r\n    }\r\n\r\n    if (_.isObject(this.props.appStore) && fieldName && formId) {\r\n      this.props.appStore.dispatch(\r\n        changeFormFieldValue(fieldName, value, formId, userInput)\r\n      );\r\n      if (userInput) {\r\n        const change_actions = this.props.element.getSettings(\"change_actions\");\r\n\r\n        if (change_actions && !isEditor()) {\r\n          const actionsManager = (\r\n            await import(\r\n              /* webpackChunkName: 'ActionsManager' */\r\n              \"../../../../../front-app/src/js/classes/modules/ActionsManager.js\"\r\n              )\r\n          ).default;\r\n          await actionsManager.callAllWidgetActions(\r\n            this.props.element.getIdForAction(),\r\n            \"change\",\r\n            change_actions,\r\n            this.props.element\r\n          );\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  /**\r\n   *\r\n   * @returns {string}\r\n   */\r\n  getValue = () => {\r\n    let value;\r\n    let formId = this.props.element.getFormId();\r\n    let fieldName = this.props.element.getFieldId();\r\n    if (isEditor()) {\r\n      value = this.state.value;\r\n    } else {\r\n      value = _.get(appStore.getState().formsStore, `${formId}`, '')\r\n      value = _.get(value, fieldName, '')\r\n    }\r\n    return value;\r\n  }\r\n\r\n  render() {\r\n    const countNumber = parseInt(this.props.element.getContent(\"count\")?.size) || 1;\r\n    const count = new Array(countNumber).fill(\"\", 0, countNumber);\r\n    const value = this.getValue();\r\n    let visualValue = this.getContent(\"second_default_value\");\r\n\r\n    if(!isNaN(visualValue)) {\r\n      visualValue = _.parseInt(visualValue) || 0;\r\n    } else {\r\n      visualValue = 0\r\n    }\r\n\r\n    return (\r\n      <StarsList className=\"altrp-stars-list\">\r\n        {\r\n          count.map((count, idx) => {\r\n            let active = value-1 >= idx\r\n\r\n            if(!this.state.changed && this.state.value === -1 ) {\r\n              active = _.parseInt(visualValue)-1 >= idx\r\n            }\r\n\r\n            return <Star\r\n              onClick={() => this.handleClick(idx)}\r\n              className={\"altrp-stars-star\" + (active ? \" active\" : \"\") + (!this.state.changed ? \" altrp-stars-visual\" : \"\")}\r\n              acitve={active}\r\n              key={idx}\r\n            >\r\n              {\r\n                active ? <StarIcon/> : <EmptyStarIcon/>\r\n              }\r\n            </Star>\r\n          })\r\n        }\r\n      </StarsList>\r\n    );\r\n  }\r\n}\r\n\r\nexport default StarsWidget;\r\n","export const CHANGE_FORM_FIELD_VALUE = 'CHANGE_FORM_FIELD_VALUE';\r\nexport const CLEAR_FORM_FIELD_VALUE = 'CHANGE_FORM_FIELD_VALUE';\r\n\r\n/**\r\n * Получает данные поля формы и сохраняет в хранилище\r\n * @param {string}fieldName\r\n * @param {*}value\r\n * @param {string}formId\r\n * @param {boolean}userInput\r\n * @return {{type: string, fieldName: *, value: *, formId: *}}\r\n */\r\nexport function changeFormFieldValue(fieldName, value, formId, userInput) {\r\n\r\n  return {\r\n    type: CHANGE_FORM_FIELD_VALUE,\r\n    fieldName,\r\n    value,\r\n    formId,\r\n    changedField: userInput ? `${formId}.${fieldName}` : null,\r\n  };\r\n}\r\n/**\r\n * Очистить данные поля формы и сохраняет в хранилище\r\n * @param {string | null}formId\r\n * @return {{type: string, fieldName: *, value: *, formId: *}}\r\n */\r\nexport function clearFormStorage(formId = null) {\r\n  return {\r\n    type: CLEAR_FORM_FIELD_VALUE,\r\n    formId,\r\n  };\r\n}\r\n\r\n"],"sourceRoot":""}