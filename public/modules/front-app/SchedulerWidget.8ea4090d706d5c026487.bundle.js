(self.webpackChunk=self.webpackChunk||[]).push([[4325],{71743:function(e,t,n){"use strict";var a=n(6610),r=n(5991),s=n(83465),o=n.n(s),p=n(29208),u=n.n(p),i=n(31468),c=n.n(i),l=n(38394),d=n.n(l),f=n(96633),v=n.n(f),m=n(99245),h=n.n(m),y=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,a.Z)(this,e),this.data=o()(t)}return(0,r.Z)(e,[{key:"getData",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return e?o()(this.data):this.data}},{key:"isEmpty",value:function(){return h()(this.data)}},{key:"getProperty",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return u()(this.data,e,t)}},{key:"hasProperty",value:function(e){return d()(this.data,e)}},{key:"setProperty",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return n instanceof e&&(n=n.getData(!1)),c()(this.data,t,n)}},{key:"unsetProperty",value:function(e){return v()(this.data,e)}}]),e}();window.AltrpModel=y,t.Z=y},24295:function(e,t,n){"use strict";n.r(t);var a=n(96156),r=n(92137),s=n(6610),o=n(5991),p=n(63349),u=n(10379),i=n(46070),c=n(77608),l=n(87757),d=n.n(l),f=n(38773);function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var h=window.altrpLibs.fullCalendar,y=h.FullCalendar,g=h.dayGridPlugin,_=h.timeGridPlugin,w=h.interaction,E=h.locales,b=window.altrpLibs.Blueprint,k=b.InputGroup,x=b.TextArea,R=function(e){(0,u.Z)(v,e);var t,n,l=(t=v,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,a=(0,c.Z)(t);if(n){var r=(0,c.Z)(this).constructor;e=Reflect.construct(a,arguments,r)}else e=a.apply(this,arguments);return(0,i.Z)(this,e)});function v(e){var t;(0,s.Z)(this,v),(t=l.call(this,e)).getFormattedEvents=(0,r.Z)(d().mark((function e(){var n,a,r,s;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new f.Z({route:t.state.settings.get_url,dynamicURL:!0}),e.next=3,n.getAll();case 3:return a=e.sent,r=a.data,s=r.map((function(e){return"0000-00-00 00:00:00"===e.end&&(delete e.end,-1!==e.start.indexOf("00:00:00")&&(e.start=e.start.substr(0,10))),e})),e.abrupt("return",s);case 7:case"end":return e.stop()}}),e)}))),t._componentDidUpdate=(0,r.Z)(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:isEditor()&&window.dispatchEvent(new Event("resize"));case 1:case"end":return e.stop()}}),e)}))),t._componentDidMount=(0,r.Z)(d().mark((function e(){var n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getFormattedEvents();case 2:n=e.sent,t.setState({startEvents:n});case 4:case"end":return e.stop()}}),e)}))),t.closePopup=function(){t.setState({popup:{status:null}})},t.dateClickHandler=function(){var e=(0,r.Z)(d().mark((function e(n){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.setState({popup:{status:"create",payload:{event:n},formData:{}}});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t.createEvent=function(){var e=(0,r.Z)(d().mark((function e(n){var a,r,s;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),a=new f.Z({route:t.state.settings.create_url,dynamicURL:!0}),r=m(m({},t.state.popup.formData),{},{start:t.state.popup.payload.event.dateStr}),e.next=5,a.post(r);case 5:return e.sent,e.next=8,t.getFormattedEvents();case 8:s=e.sent,t.setState({startEvents:s}),t.closePopup();case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t.eventChangeHandler=function(){var e=(0,r.Z)(d().mark((function e(n){var a,r,s;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=new f.Z({route:t.state.settings.update_url,dynamicURL:!0}),r=JSON.parse(JSON.stringify(n.event)),s=r.id,e.next=6,a.put(+s,{start:r.start,end:r.end});case 6:e.sent,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.log({error:e.t0});case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),t.openEvent=function(e){var n=JSON.parse(JSON.stringify(e.event));t.setState({popup:{status:"edit",payload:{event:e.event},formData:m(m({},n),n.extendedProps)}})},t.editEvent=function(){var e=(0,r.Z)(d().mark((function e(n){var a,r,s,o,p,u;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(u in n.preventDefault(),a=new f.Z({route:t.state.settings.update_url,dynamicURL:!0}),r=t.state.popup.formData,s=t.state.popup.payload.event.id,o=t.calendar.current.getApi(),p=m(m({},p=JSON.parse(JSON.stringify(t.state.popup.payload.event))),p.extendedProps),r)p[u]=r[u];return delete p.extendedProps,delete p.updated_at,delete p.deleted_at,delete p.created_at,e.next=14,a.put(+s,p);case 14:e.sent,t.setState({startEvents:o.getEvents().map((function(e){return e.id==p.id?p:e}))}),t.closePopup();case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t.deleteEvent=(0,r.Z)(d().mark((function e(){var n,a;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new f.Z({route:t.state.settings.update_url,dynamicURL:!0}),a=t.state.popup.payload.event.id,t.closePopup(),t.state.popup.payload.event.remove(),e.next=6,n.delete(a);case 6:case"end":return e.stop()}}),e)}))),t.eventInputHandler=function(e){t.setState({popup:m(m({},t.state.popup),{},{formData:m(m({},t.state.popup.formData),{},(0,a.Z)({},e.target.name,e.target.value))})})};var n=e.element.getSettings();return t.state={startEvents:[],settings:n,popup:{status:null}},e.element.component=(0,p.Z)(t),window.elementDecorator&&window.elementDecorator((0,p.Z)(t)),e.baseRender&&(t.render=e.baseRender((0,p.Z)(t))),t.popupLocalization={"en-gb":{create:"Create",cancel:"Cancel",title:"Title",delete:"Delete",done:"Done"},ru:{create:"Создать",cancel:"Отменить",title:"Название",delete:"Удалить",done:"Закончить"}},t.calendar=React.createRef(),t}return(0,o.Z)(v,[{key:"render",value:function(){var e,t=this,n=this.props.element.getResponsiveSetting("lang","","en-gb"),a=this.popupLocalization[n];return React.createElement("div",{className:"popup-wrapper"},React.createElement(y,{locale:E[n],plugins:[g,w,_],initialView:"dayGridMonth",events:this.state.startEvents,editable:!0,headerToolbar:{left:"prev,next",center:"title",right:"timeGridDay,timeGridWeek,dayGridMonth"},dateClick:this.dateClickHandler,eventClick:this.openEvent,eventChange:this.eventChangeHandler,ref:this.calendar}),!!this.state.popup.status&&React.createElement("div",{className:"popup"},React.createElement("form",{onSubmit:function(){"create"===t.state.popup.status?t.createEvent():t.editEvent()}},React.createElement("div",{className:"popup__body"},React.createElement("div",{className:"popup__field-title"},null==a?void 0:a.title),React.createElement(k,{type:"text",name:"title",onChange:this.eventInputHandler,className:"popup__text-field",value:this.state.popup.formData.title||""}),null===(e=this.state.settings.repeater_fields_section)||void 0===e?void 0:e.map((function(e){return React.createElement("div",{key:e.field_name_repeater},React.createElement("div",{className:"popup__field-title"},e.label_repeater),("text"===e.input_type_repeater||!e.input_type_repeater)&&React.createElement(k,{type:"text",name:e.field_name_repeater,onChange:t.eventInputHandler,className:"popup__text-field",value:t.state.popup.formData[e.field_name_repeater]||""}),"textarea"===e.input_type_repeater&&React.createElement(x,{name:e.field_name_repeater,onChange:t.eventInputHandler,className:"popup__text-field popup__textarea",value:t.state.popup.formData[e.field_name_repeater]||""}))}))),React.createElement("div",{className:"popup__actions"},"create"==this.state.popup.status?React.createElement("input",{type:"button",className:"button",value:a.create,onClick:this.createEvent}):React.createElement("input",{type:"button",className:"button",value:a.done,onClick:this.editEvent}),React.createElement("input",{type:"button",className:"button",value:a.cancel,onClick:this.closePopup}),"edit"==this.state.popup.status&&React.createElement("input",{type:"button",className:"button button-danger",value:a.delete,onClick:this.deleteEvent})))))}}]),v}(Component);t.default=R}}]);
//# sourceMappingURL=SchedulerWidget.8ea4090d706d5c026487.bundle.js.map