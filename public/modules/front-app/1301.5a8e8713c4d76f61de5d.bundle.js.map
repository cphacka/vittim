{"version":3,"sources":["webpack:///./resources/modules/admin/src/js/helpers.js","webpack:///./resources/modules/editor/src/js/classes/AltrpModel.js","webpack:///./resources/modules/editor/src/js/components/altrp-input/AltrpInputFile.js","webpack:///./resources/modules/editor/src/js/components/altrp-input/MaskedInput.js","webpack:///./resources/modules/editor/src/js/components/altrp-input/AltrpInput.js"],"names":["iconsManager","window","IconsManager","AltrpModel","data","this","cloneDeep","clone","isEmpty","name","defaultValue","get","has","value","getData","set","unset","props","labelClick","e","isEditor","preventDefault","deleteItem","idx","files","state","splice","filesForDisplay","length","setState","console","log","_","each","f","fr","FileReader","readAsDataURL","onload","push","src","result","alt","isFunction","onChange","target","FileList","types","settings","content_accept","split","_f","forEach","type","trim","replace","indexOf","multiple","select2_multiple","placeholder","content_placeholder","accept","classes","className","join","onClick","renderIcon","renderAsset","map","key","Component","previewValue","max","mask","inputProps","content_mask","inputRef","React","handleChange","bind","updateMask","handleBackspace","s","continueSplit","valueIndex","maxLength","numbersLength","match","stringLength","char","currentValueChar","isNaN","newChar","slice","prevProps","prevState","snapshot","maskSetting","input","onKeyDown","isValid","Input","altrpLibs","Blueprint","InputGroup","content_type","mask_mismatch_message","onBlur","validateEmail"],"mappings":"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","file":"1301.5a8e8713c4d76f61de5d.bundle.js","sourcesContent":["import IconsManager from \"../../../editor/src/js/classes/modules/IconsManager\";\r\nimport Resource from \"../../../editor/src/js/classes/Resource\";\r\nimport { isEmpty } from \"lodash\";\r\n\r\nexport function redirect(url) {\r\n  url = url || '/';\r\n  window.location.assign(url);\r\n}\r\nexport function generateId() {\r\n  return '_' + Math.random().toString(36).substr(2, 9);\r\n}\r\n/**\r\n * @return {IconsManager}\r\n* */\r\nexport function iconsManager() {\r\n  if (!window.iconsManager) {\r\n    window.iconsManager = new IconsManager();\r\n  }\r\n  return window.iconsManager;\r\n}\r\n\r\nexport async function logout() {\r\n  let res = await (new Resource({ route: '/logout' })).post();\r\n  redirect(res.location)\r\n}\r\n\r\nexport function pageReload() {\r\n  document.location.reload(true);\r\n}\r\n\r\nconst a = { \"Ё\": \"Yo\", \"Й\": \"I\", \"Ц\": \"Ts\", \"У\": \"U\", \"К\": \"K\", \"Е\": \"E\", \"Н\": \"N\", \"Г\": \"G\", \"Ш\": \"Sh\", \"Щ\": \"Sch\", \"З\": \"Z\", \"Х\": \"H\", \"Ъ\": \"\", \"ё\": \"yo\", \"й\": \"i\", \"ц\": \"ts\", \"у\": \"u\", \"к\": \"k\", \"е\": \"e\", \"н\": \"n\", \"г\": \"g\", \"ш\": \"sh\", \"щ\": \"sch\", \"з\": \"z\", \"х\": \"h\", \"ъ\": \"\", \"Ф\": \"F\", \"Ы\": \"I\", \"В\": \"V\", \"А\": \"a\", \"П\": \"P\", \"Р\": \"R\", \"О\": \"O\", \"Л\": \"L\", \"Д\": \"D\", \"Ж\": \"ZH\", \"Э\": \"E\", \"ф\": \"f\", \"ы\": \"i\", \"в\": \"v\", \"а\": \"a\", \"п\": \"p\", \"р\": \"r\", \"о\": \"o\", \"л\": \"l\", \"д\": \"d\", \"ж\": \"zh\", \"э\": \"e\", \"Я\": \"Ya\", \"Ч\": \"CH\", \"С\": \"S\", \"М\": \"M\", \"И\": \"I\", \"Т\": \"T\", \"Ь\": \"\", \"Б\": \"B\", \"Ю\": \"YU\", \"я\": \"ya\", \"ч\": \"ch\", \"с\": \"s\", \"м\": \"m\", \"и\": \"i\", \"т\": \"t\", \"ь\": \"\", \"б\": \"b\", \"ю\": \"yu\" };\r\n\r\n/**\r\n * Транслитерация\r\n * @param {string}str\r\n * @return {string}\r\n */\r\nexport function transliterate(str) {\r\n  if (!str) {\r\n    return \"\";\r\n  }\r\n  return str.split('').map(function (char) {\r\n    return _.isUndefined(a[char]) ? char : a[char];\r\n  }).join(\"\");\r\n}\r\n\r\n/**\r\n * Парсит строку в name для БД\r\n * @param {string}str\r\n * @return {string}\r\n */\r\nexport function titleToName(str) {\r\n  str = transliterate(str);\r\n  return str.toLowerCase().replace(/^\\d+/, '').replace(/[^\\d\\w]/g, '_');\r\n\r\n}\r\n\r\nexport function titleToNameTwo(str) {\r\n  return str.replace(/^\\d+/, '')\r\n}\r\n\r\nexport function titleToPath(str) {\r\n  str = transliterate(str);\r\n  return str.toLowerCase().replace(/^\\d+/, '').replace(/[^\\d\\w]/g, '-');\r\n\r\n}\r\n/** @function objectDeepCleaning\r\n  * Удаляет все свойства id, и чистит settings (пока нет) todo: нужна оптимизация\r\n  * @param {object} collection\r\n  * @return {object} Объект после удаления всех свойств id, и чистки settings\r\n */\r\nexport function objectDeepCleaning(collection) {\r\n  return collection;\r\n  if (typeof collection !== \"object\" || collection === null) return collection;\r\n  if (collection.id) delete collection.id;\r\n\r\n  if (Array.isArray(collection)) {\r\n    for (let index = 0; index < collection.length; index++) {\r\n      const element = collection[index];\r\n      objectDeepCleaning(element);\r\n    }\r\n  } else {\r\n    if (collection.hasOwnProperty(\"settings\")) deleteEmptyPropsDeep(collection.settings);\r\n    if (isEmpty(collection.settings)) delete collection.settings; // удаляем settings, если оно - пустой объект\r\n    for (const key in collection) {\r\n      if (collection.hasOwnProperty(key)) {\r\n        const element = collection[key];\r\n        objectDeepCleaning(element);\r\n      }\r\n    }\r\n  }\r\n  return collection;\r\n}\r\n/** @function deleteEmptyPropsDeep\r\n  * Удаляет в объекте все свойства, значения которых - null, или \"\", или {}\r\n  * @param {object} collection\r\n */\r\nexport function deleteEmptyPropsDeep(collection) {\r\n  const deleteProps = [];\r\n  for (const key in collection) {\r\n    if (collection[key] === null || collection[key] === \"\") {\r\n      deleteProps.push(key);\r\n    }\r\n    deleteProps.forEach(key => delete collection[key]);\r\n\r\n    if (typeof collection[key] === \"object\") {\r\n      deleteEmptyPropsDeep(collection[key]);\r\n      if (isEmpty(collection[key])) delete collection[key];\r\n    }\r\n  }\r\n}\r\n\r\n\r\nexport function buildPagesTree(pages) {\r\n  const level = 0;\r\n  const tree = [];\r\n  const roots = pages.filter(({ parent_page_id }) => parent_page_id === null);\r\n\r\n  if (!roots.length) return pages;\r\n\r\n  roots.forEach(root => {\r\n    tree.push(root);\r\n    treeRecursion(root.id, level + 1);\r\n  });\r\n\r\n  function treeRecursion(parentId, level) {\r\n    const children = pages.filter(({ parent_page_id }) => parent_page_id === parentId);\r\n    children.forEach(page => {\r\n      page.title = \"—\".repeat(level) + page.title;\r\n      tree.push(page);\r\n      treeRecursion(page.id, level + 1);\r\n    });\r\n  }\r\n\r\n  return tree;\r\n}\r\n\r\n\r\nexport function filterUsers(users, roleFilter) {\r\n  return users.filter(user => user.roles.some(role => role.id === roleFilter));\r\n}\r\n\r\n\r\nexport function sortUsers(users, sortingField, order) {\r\n  const sortedUsers = users.sort((a, b) => {\r\n    if (a[sortingField] < b[sortingField]) {\r\n      return -1;\r\n    }\r\n    if (a[sortingField] > b[sortingField]) {\r\n      return 1;\r\n    }\r\n    return 0;\r\n  });\r\n\r\n  return order === 'ASC' ? sortedUsers : sortedUsers.reverse();\r\n}\r\n","/**\r\n * Имеет интерфейс для доступы к свойствам data (любой вложенности)\r\n * @class AltrpModel\r\n */\r\nimport cloneDeep from 'lodash.clonedeep';\r\nimport get from 'lodash.get';\r\nimport set from 'lodash.set';\r\nimport has from 'lodash.has';\r\nimport unset from 'lodash.unset';\r\nimport isEmpty from 'lodash.isempty';\r\n// import {cloneDeep, get, set, has, unset, isString, isEmpty} from \"lodash\";\r\n\r\nclass AltrpModel {\r\n  constructor(data = {}) {\r\n    this.data = cloneDeep(data);\r\n  }\r\n\r\n  /**\r\n   * Возваращает объект данных\r\n   * @params {boolean} clone - клонировать или ссылку на данные\r\n   * @return {{}}\r\n   */\r\n  getData(clone = true) {\r\n    if(clone){\r\n      return cloneDeep(this.data);\r\n    }\r\n    return this.data;\r\n  }\r\n\r\n  /**\r\n   * Пустой ли объект\r\n   */\r\n  isEmpty(){\r\n    return isEmpty(this.data);\r\n  }\r\n  /**\r\n   * Возврашает значение свойства name\r\n   * @params {string} name\r\n   * @params {*} defaultValue\r\n   * @return {*}\r\n   */\r\n  getProperty(name, defaultValue = '') {\r\n    return get(this.data, name, defaultValue);\r\n  }\r\n  /**\r\n   * Возврашает значение свойства name\r\n   * @params {string} name\r\n   * @params {*} defaultValue\r\n   * @return {*}\r\n   */\r\n  hasProperty(name, defaultValue = '') {\r\n    return has(this.data, name);\r\n  }\r\n  /**\r\n   * Возврашает значение свойства name\r\n   * @params {string} name\r\n   * @params {*} defaultValue\r\n   * @return {{}}\r\n   */\r\n  setProperty(name, value = '') {\r\n    if(value instanceof AltrpModel){\r\n      value = value.getData(false);\r\n    }\r\n    return set(this.data, name, value);\r\n  }\r\n  /**\r\n   * Удаляет свойства name\r\n   * @params {string} name\r\n   * @return {*}\r\n   */\r\n  unsetProperty(name) {\r\n    return unset(this.data, name);\r\n  }\r\n}\r\nwindow.AltrpModel = AltrpModel;\r\nexport default AltrpModel\r\n","import React, { Component } from \"react\";\r\nimport { iconsManager } from \"../../../../../admin/src/js/helpers\";\r\nimport { isEditor, renderAsset } from \"../../../../../front-app/src/js/helpers\";\r\n\r\nclass AltrpInputFile extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      filesForDisplay: [],\r\n      files: []\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Клик по леблу\r\n   * @param {{}} e\r\n   */\r\n  labelClick = e => {\r\n    if (isEditor()) {\r\n      e.preventDefault();\r\n    }\r\n  };\r\n  /**\r\n   * Удалить элемент\r\n   * @param e\r\n   * @param idx\r\n   */\r\n  deleteItem = (e, idx) => {\r\n    e.preventDefault();\r\n    let { files } = this.state;\r\n    files.splice(idx, 1);\r\n    let filesForDisplay = [];\r\n    if (!files.length) {\r\n      this.setState(state => ({ ...state, filesForDisplay, files }));\r\n    }\r\n    console.log(files);\r\n    _.each(files, f => {\r\n      let fr = new FileReader();\r\n      fr.readAsDataURL(f);\r\n      fr.onload = () => {\r\n        filesForDisplay.push({\r\n          src: fr.result,\r\n          alt: f.name || \"\"\r\n        });\r\n        if (filesForDisplay.length === files.length) {\r\n          this.setState(state => ({ ...state, filesForDisplay, files }));\r\n        }\r\n      };\r\n    });\r\n    if (_.isFunction(this.props.onChange)) {\r\n      this.props.onChange(files);\r\n    }\r\n  };\r\n  /**\r\n   * Обновление Файлов\r\n   * @param e\r\n   */\r\n  onChange = e => {\r\n    if (!e.target.files instanceof FileList) {\r\n      return;\r\n    }\r\n    let files = [];\r\n    let types = this.props.settings.content_accept\r\n      ? this.props.settings.content_accept.split(\",\")\r\n      : [];\r\n\r\n    _.each(e.target.files, _f => {\r\n      types.forEach(type => {\r\n        type = type.trim();\r\n        type = type.replace(\"*\", \"\");\r\n        if (_f.type.indexOf(type) === 0) {\r\n          files.push(_f);\r\n        }\r\n      });\r\n    });\r\n    let filesForDisplay = [];\r\n    if (!files.length) {\r\n      this.setState(state => ({ ...state, filesForDisplay, files }));\r\n    }\r\n    _.each(files, f => {\r\n      let fr = new FileReader();\r\n      fr.readAsDataURL(f);\r\n      fr.onload = () => {\r\n        filesForDisplay.push({\r\n          src: fr.result,\r\n          alt: f.name || \"\"\r\n        });\r\n        if (filesForDisplay.length === files.length) {\r\n          console.log(filesForDisplay);\r\n          this.setState(state => ({ ...state, filesForDisplay, files }));\r\n        }\r\n      };\r\n    });\r\n    if (_.isFunction(this.props.onChange)) {\r\n      this.props.onChange(files);\r\n    }\r\n  };\r\n  render() {\r\n    // console.log(this.props);\r\n    let multiple = this.props.settings.select2_multiple;\r\n    let placeholder = this.props.settings.content_placeholder || \"\";\r\n    const { filesForDisplay } = this.state;\r\n    let accept = this.props.settings.content_accept || \"\";\r\n    const classes = [\"altrp-field-file\"];\r\n    if (!filesForDisplay.length) {\r\n      classes.push(\"altrp-field-file_empty\");\r\n    }\r\n    return (\r\n      <label className={classes.join(\" \")} onClick={this.labelClick}>\r\n        <span className=\"altrp-field-file__placeholder\">{placeholder}</span>\r\n        <input\r\n          type=\"file\"\r\n          className=\"altrp-field-file__field\"\r\n          multiple={multiple}\r\n          accept={accept}\r\n          onChange={this.onChange}\r\n        />\r\n        <span className=\"altrp-field-file-media-list media-list\">\r\n          {isEditor() ? (\r\n            <span className=\"media-list-item\">\r\n              {iconsManager().renderIcon(\"times\", {\r\n                className: \"media-list-item__remove\"\r\n              })}\r\n              {renderAsset(\r\n                {},\r\n                {\r\n                  className: \"media-list-item__img\"\r\n                }\r\n              )}\r\n            </span>\r\n          ) : (\r\n            filesForDisplay.map((f, idx) => {\r\n              return (\r\n                <span key={idx} className=\"media-list-item\">\r\n                  {iconsManager().renderIcon(\"times\", {\r\n                    className: \"media-list-item__remove\",\r\n                    onClick: e => {\r\n                      this.deleteItem(e, idx);\r\n                    }\r\n                  })}\r\n                  <img className=\"media-list-item__img\" {...f} />\r\n                </span>\r\n              );\r\n            })\r\n          )}\r\n        </span>\r\n      </label>\r\n    );\r\n  }\r\n}\r\n\r\nexport default AltrpInputFile;\r\n","import React from \"react\";\r\n// import { createMask, Masked } from \"imask\";\r\n// import {isNumber} from \"../../../../../altrp-reports/src/helpers/number\";\r\n\r\nclass MaskedInput extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      previewValue: \"\",\r\n      value: \"\",\r\n      max: 0,\r\n      type: [],\r\n      mask: _.clone(props.inputProps.settings.content_mask)\r\n    }\r\n\r\n    this.inputRef = React.createRef();\r\n    this.handleChange = this.handleChange.bind(this);\r\n    this.updateMask = this.updateMask.bind(this);\r\n    this.handleBackspace = this.handleBackspace.bind(this);\r\n  }\r\n\r\n  // componentDidUpdate(prevProps, prevState, snapshot) {\r\n  //   if(prevProps.inputProps.type !== this.props.inputProps.type) {\r\n  //     this.maskedValue.updateValue()\r\n  //   }\r\n  // }\r\n\r\n  componentDidMount() {\r\n\r\n    this.setState((s) => ({\r\n      ...s,\r\n      mask: this.props.mask\r\n    }))\r\n\r\n    this.updateMask()\r\n  }\r\n\r\n  updateMask() {\r\n    const mask = this.state.mask;\r\n    const value = this.state.value;\r\n\r\n    // let mask = \"+{7}(000)000-00-00\"\r\n\r\n    // const findDefaultText = RegExp(\"[^{}]*\", \"gm\");\r\n    //\r\n    // mask = findDefaultText.exec(mask);\r\n    let previewValue = \"\";\r\n    let continueSplit = false;\r\n    const split = mask.split(\"\");\r\n    let valueIndex = 0;\r\n    let maxLength = 0;\r\n    let type = \"\";\r\n    let numbersLength = (mask.match(/0/g) || []).length;\r\n    let stringLength = (mask.match(/_/g) || []).length;\r\n    maxLength += numbersLength + stringLength;\r\n\r\n    if(stringLength > 0) {\r\n      type = \"string\"\r\n    } else if(numbersLength > 0) {\r\n      type = \"number\"\r\n    }\r\n\r\n    if(value) {\r\n      for(const char of split) {\r\n        const currentValueChar = value[valueIndex]\r\n\r\n        if(!currentValueChar && char !== \"\") {\r\n          break;\r\n        }\r\n\r\n        if(char === \"}\") {\r\n          continueSplit = false\r\n        }\r\n\r\n        if(continueSplit) {\r\n          previewValue += char;\r\n          continue;\r\n        }\r\n\r\n        switch (char) {\r\n          case \"0\":\r\n            if(!isNaN(currentValueChar)) {\r\n              if(currentValueChar) {\r\n                previewValue += currentValueChar\r\n                valueIndex = valueIndex + 1;\r\n              }\r\n            }\r\n            break\r\n          case \"_\":\r\n            if(currentValueChar) {\r\n              previewValue += currentValueChar\r\n              valueIndex = valueIndex + 1;\r\n            }\r\n            break\r\n          default:\r\n            previewValue += char\r\n        }\r\n      }\r\n    }\r\n\r\n    this.setState((s) => ({\r\n      ...s,\r\n      previewValue,\r\n      max: maxLength,\r\n      type\r\n    }))\r\n\r\n    return previewValue\r\n\r\n\r\n    // \\[([^\\][]*)] find []\r\n  }\r\n\r\n  handleChange(e) {\r\n    if(this.state.value.length < this.state.max) {\r\n      let value = e.target.value;\r\n      const newChar = value.slice(-1);\r\n\r\n      switch (this.state.type) {\r\n        case \"number\":\r\n          if(!isNaN(newChar)) {\r\n            this.setState((s) => ({\r\n              ...s,\r\n              value: s.value + newChar\r\n            }), () => {\r\n              this.updateMask()\r\n              this.props.inputProps.onChange({ target: {value: this.state.value}})\r\n            })\r\n          }\r\n          break\r\n        default:\r\n          this.setState((s) => ({\r\n            ...s,\r\n            value: s.value + newChar\r\n          }), () => {\r\n            this.updateMask()\r\n            this.props.inputProps.onChange({ target: {value: this.state.value}})\r\n          })\r\n\r\n      }\r\n    }\r\n  }\r\n\r\n  handleBackspace(e) {\r\n    if(e.key === \"Backspace\") {\r\n      this.setState((s) => ({\r\n        ...s,\r\n        value: s.value.slice(0, -1)\r\n      }), () => {\r\n        this.updateMask()\r\n      })\r\n\r\n      e.preventDefault()\r\n    }\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState, snapshot) {\r\n    const maskSetting = this.props.inputProps.settings.content_mask;\r\n\r\n    if(this.state.mask !== maskSetting) {\r\n      this.setState((s) => ({\r\n        ...s,\r\n        mask: maskSetting,\r\n        previewValue: \"\",\r\n        value: \"\",\r\n        type: [],\r\n        max: 0,\r\n      }))\r\n      this.updateMask()\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return React.createElement(this.props.input, {\r\n      ...this.props.inputProps,\r\n      inputRef: this.inputRef,\r\n      onChange: this.handleChange,\r\n      onKeyDown: this.handleBackspace,\r\n      value: this.state.previewValue\r\n    })\r\n  }\r\n}\r\n\r\nexport default MaskedInput\r\n","import React, { Component } from \"react\";\r\nimport (\"./altrp-input.scss\");\r\nimport AltrpInputFile from \"./AltrpInputFile\";\r\nimport { isValueMatchMask, validateEmail } from \"../../../../../front-app/src/js/helpers\";\r\nimport MaskedInput from \"./MaskedInput\";\r\n\r\nclass AltrpInput extends Component {\r\n  state = {\r\n    isValid: true\r\n  };\r\n\r\n  // checkValidity = mask => {\r\n  //   if (! mask) return;\r\n  //   let value = this.props.value.replace(/_/g, '');\r\n  //   let isValid = ! ! (value.length);\r\n  //   this.setState(state => ({...state, isValid}));\r\n  //   _.set(this, 'props.element.maskIsValid', isValid);\r\n  // };\r\n\r\n  // /**\r\n  //  *\r\n  //  * @param {{}} prevProps\r\n  //  * @param {{}} prevState\r\n  //  */\r\n  // componentDidUpdate(prevProps, prevState){\r\n  //   if((! this.props.value) && this.state.isValid){\r\n  //     this.setState(state => ({...state, isValid: false}));\r\n  //     _.set(this, 'props.element.maskIsValid', false);\r\n  //   }\r\n  // }\r\n  render() {\r\n    let Input = window.altrpLibs.Blueprint.InputGroup;\r\n    const { isValid } = this.state;\r\n    const { content_type, content_mask, mask_mismatch_message } = this.props.settings;\r\n    const inputProps = {\r\n      ...this.props,\r\n      inputRef: this.props.inputRef,\r\n    };\r\n    switch (content_type) {\r\n      case \"file\": {\r\n        return <AltrpInputFile {...inputProps} />;\r\n      }\r\n    }\r\n    if (content_mask) {\r\n      return (<>\r\n          <MaskedInput\r\n            mask={content_mask}\r\n            inputProps={inputProps}\r\n            input={Input}\r\n          />\r\n          {!isValid && mask_mismatch_message && <p className=\"mask-mismatch-message\">{mask_mismatch_message}</p>}\r\n        </>\r\n      );\r\n    }\r\n\r\n    if (content_type === 'email' && mask_mismatch_message) {\r\n      inputProps.onBlur = e => {\r\n        this.props.onBlur(e);\r\n        this.setState({ isValid: validateEmail(e.target.value) });\r\n      };\r\n\r\n      if (!isValid) {\r\n        inputProps.onChange = e => {\r\n          this.props.onChange(e);\r\n          this.setState({ isValid: validateEmail(e.target.value) });\r\n        };\r\n      }\r\n    }\r\n\r\n\r\n    return <>\r\n      <Input {...inputProps} />\r\n      {!isValid && content_type === 'email' && mask_mismatch_message &&\r\n      <p className=\"mask-mismatch-message\">{mask_mismatch_message}</p>}\r\n    </>;\r\n  }\r\n}\r\n\r\nexport default AltrpInput;\r\n"],"sourceRoot":""}