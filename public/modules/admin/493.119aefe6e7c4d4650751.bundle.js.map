{"version":3,"sources":["webpack:///./resources/modules/admin/src/components/AdvancedSettings.js"],"names":["MediaInput","React","AdvancedSettings","props","toggleDebug","e","value","target","checked","Resource","route","put","setState","state","debugOn","toggleLoadingOption","loadByUser","deleteAllTemplatesReviews","confirm","store","setAdminDisable","delete","success","alert","setAdminEnable","clearAllCache","updateAllBackendResources","post","updateAllSiteJavascript","allSiteJavascript","encrypt","get","all_site_js","altrp_debug","altrp_user_load","this","JSON","stringify","dispatch","setAdminLogo","className","htmlFor","Suspense","fallback","onChange","changeAdminLogo","adminLogo","onClick","type","mode","height","style","width","Component","connect"],"mappings":"q1BAQA,IAAMA,EAAaC,QAAW,kBAAM,kCAE9BC,E,4cACJ,WAAYC,GAAM,6BAChB,cAAMA,IAuCRC,YAxCkB,mCAwCJ,WAAOC,GAAP,8EAGRC,EAAQD,EAAEE,OAAOC,QAHT,SAIN,IAAIC,UAAS,CAACC,MAAM,yBAAyBC,IAAI,cAAe,CAACL,UAJ3D,OAKZ,EAAKM,UAAS,SAAAC,GAAK,cACdA,GADc,IAEjBC,QAASR,OAPC,2CAxCI,wDAwDlBS,oBAxDkB,mCAwDI,WAAOV,GAAP,8EAGhBC,EAAQD,EAAEE,OAAOC,QAHD,SAId,IAAIC,UAAS,CAACC,MAAM,yBAAyBC,IAAI,kBAAmB,CAACL,UAJvD,OAKpB,EAAKM,UAAS,SAAAC,GAAK,cACdA,GADc,IAEjBG,WAAYV,OAPM,2CAxDJ,wDAuElBW,0BAvEkB,mCAuEU,WAAOZ,GAAP,iFACNa,QAAQ,gBADF,yEAK1BC,oBAAeC,WALW,SAMV,IAAIX,UAAS,CAACC,MAAM,wBAAwBW,SANlC,kBAOnBC,QAPmB,kCAQlBC,MAAM,WARY,QAU1BJ,oBAAeK,WAVW,4CAvEV,wDAuFlBC,cAvFkB,mCAuFF,WAAOpB,GAAP,iFACMa,QAAQ,gBADd,kFAKE,IAAIT,UAAS,CAACC,MAAM,4BAA4BW,SALlD,yDAvFE,wDAmGlBK,0BAnGkB,mCAmGU,WAAOrB,GAAP,iFACNa,QAAQ,gBADF,yEAK1BC,oBAAeC,WALW,SAOV,IAAIX,UAAS,CAACC,MAAM,qCAAqCiB,KAAK,IAPpD,kBAQnBL,QARmB,kCASlBC,MAAM,WATY,QAW1BJ,oBAAeK,WAXW,4CAnGV,wDAmNjBI,yBAnNiB,iBAmNS,8FACnB,IAAInB,UAAS,CAACC,MAAM,yBAAyBC,IAAI,cAAe,CAACL,MAAO,EAAKO,MAAMgB,kBAAmBC,SAAS,IAD5F,2CAjNzB,EAAKjB,MAAQ,CACXgB,kBAAmB,GACnBf,SAAS,EACTE,YAAY,GALE,E,qEAYlB,wGACmC,IAAIP,UAAS,CAACC,MAAO,yBAAyBqB,IAAI,4BADrF,sBACkHC,YADlH,0BACiI,GADjI,cACQH,EADR,cAG2B,IAAIpB,UAAS,CAACC,MAAM,yBAAyBqB,IAAI,eAH5E,cAGMjB,IAHN,OAG4FmB,YAH5F,UAI8B,IAAIxB,UAAS,CAACC,MAAM,yBAAyBqB,IAAI,mBAJ/E,QAIMf,IAJN,OAImGkB,gBACjGC,KAAKvB,UAAS,SAAAC,GAAK,cAASA,GAAT,IACjBgB,oBACAf,UACAE,kBARJ,iD,+FAkBA,WAAsBV,GAAtB,iFACQ,IAAIG,UAAS,CAACC,MAAM,yBAAyBC,IAAI,aAAc,CAACL,MAAO8B,KAAKC,UAAU/B,KAD9F,OAEE6B,KAAKG,UAASC,OAAajC,IAF7B,gD,kEAkFA,WAAS,WACP,OAAO,uBAAKkC,UAAU,yBAEpB,uBAAKA,UAAU,sBACb,uBAAKA,UAAU,gCACb,uBAAKA,UAAU,+BACb,yBAAOC,QAAQ,2BAA2BD,UAAU,wBAApD,eAGA,gBAAC,EAAAE,SAAD,CAAUC,SAAU,WAClB,gBAAC3C,EAAD,CAAY4C,SAAUT,KAAKU,gBAAiBvC,MAAO6B,KAAKhC,MAAM2C,cAIlE,uBAAKN,UAAU,yBACb,uBAAKA,UAAU,+BACb,uBAAKA,UAAU,wBAAf,gCACA,0BAAQA,UAAU,+BACVO,QAASZ,KAAKlB,2BADtB,UAMF,uBAAKuB,UAAU,+BACb,uBAAKA,UAAU,wBAAf,iCACA,0BAAQA,UAAU,+BACVO,QAASZ,KAAKT,2BADtB,WAMF,uBAAKc,UAAU,+BACb,uBAAKA,UAAU,wBAAf,oBACA,0BAAQA,UAAU,+BACVO,QAASZ,KAAKV,eADtB,WAOJ,uBAAKe,UAAU,yBACb,uBAAKA,UAAU,6CACb,uBAAKA,UAAU,iBAAf,mBACA,yBAAOA,UAAU,wBACVI,SAAUT,KAAK/B,YAEfI,QAAS2B,KAAKtB,MAAMC,QACpBkC,KAAK,cAGd,uBAAKR,UAAU,6CACb,uBAAKA,UAAU,iBAAf,2BACA,yBAAOA,UAAU,wBACVI,SAAUT,KAAKpB,oBAEfP,QAAS2B,KAAKtB,MAAMG,WACpBgC,KAAK,gBAKlB,uBAAKR,UAAU,oBACb,uBAAKA,UAAU,0CACb,uBAAKA,UAAU,wBAAf,4CACA,gBAAC,IAAD,CAAiBlC,MAAO6B,KAAKtB,MAAMgB,kBAClBoB,KAAK,aACLL,SAAU,SAAAtC,GAAK,OAAI,EAAKM,SAAS,CAAEiB,kBAAmBvB,KACtD4C,OAAO,OACPC,MAAO,CACLC,MAAO,UAG1B,0BAAQZ,UAAU,+BACVO,QAASZ,KAAKP,yBADtB,kB,GAzLmByB,aA+N/B,WAAeC,SANf,SAAyBzC,GACvB,MAAO,CACLiC,UAAWjC,EAAMiC,aAIrB,CAAwC5C","file":"493.119aefe6e7c4d4650751.bundle.js","sourcesContent":["import React, {Component, Suspense} from \"react\";\r\nimport {connect} from \"react-redux\";\r\nimport {setAdminLogo} from \"../js/store/admin-logo/actions\";\r\nimport Resource from \"../../../editor/src/js/classes/Resource\";\r\nimport {setAdminDisable, setAdminEnable} from \"../js/store/admin-state/actions\";\r\nimport AltrpCodeEditor from \"./altrp-editor/AltrpCodeEditor\";\r\nimport store from '../js/store/store';\r\n\r\nconst MediaInput = React.lazy(() => import('./media-input/MediaInput.js'));\r\n\r\nclass AdvancedSettings extends Component {\r\n  constructor(props){\r\n    super(props);\r\n    this.state = {\r\n      allSiteJavascript: '',\r\n      debugOn: false,\r\n      loadByUser: false,\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   */\r\n  async componentDidMount() {\r\n    const allSiteJavascript = (await new Resource({route: '/admin/ajax/settings'}).get('all_site_js?decrypt=true')).all_site_js || '';\r\n    // let debugOn = ! ! (await new Resource({route:'/admin/ajax/settings'}).get('altrp_debug').altrp_debug);\r\n    let debugOn = ! ! (await new Resource({route:'/admin/ajax/settings'}).get('altrp_debug')).altrp_debug;\r\n    let loadByUser = ! ! (await new Resource({route:'/admin/ajax/settings'}).get('altrp_user_load')).altrp_user_load;\r\n    this.setState(state => ({...state,\r\n      allSiteJavascript,\r\n      debugOn,\r\n      loadByUser,\r\n    }));\r\n  }\r\n\r\n  /**\r\n   * Изменить лого\r\n   * @param value\r\n   * @return {Promise<void>}\r\n   */\r\n\r\n  async changeAdminLogo(value){\r\n    await new Resource({route:'/admin/ajax/settings'}).put('admin_logo', {value: JSON.stringify(value)});\r\n    this.dispatch(setAdminLogo(value));\r\n  }\r\n  /**\r\n   * Включить дебаг на фронте\r\n   * @param e\r\n   * @return {Promise<void>}\r\n   */\r\n\r\n  toggleDebug = async (e)=>{\r\n    // await new Resource({route:'/admin/ajax/settings'}).put('admin_logo', {value: JSON.stringify(value)});\r\n    // this.dispatch(setAdminLogo(value));\r\n    let value = e.target.checked;\r\n    await new Resource({route:'/admin/ajax/settings'}).put('altrp_debug', {value});\r\n    this.setState(state=>({\r\n      ...state,\r\n      debugOn: value,\r\n    }))\r\n  };\r\n  /**\r\n   * Включить дебаг на фронте\r\n   * @param e\r\n   * @return {Promise<void>}\r\n   */\r\n\r\n  toggleLoadingOption = async (e)=>{\r\n    // await new Resource({route:'/admin/ajax/settings'}).put('admin_logo', {value: JSON.stringify(value)});\r\n    // this.dispatch(setAdminLogo(value));\r\n    let value = e.target.checked;\r\n    await new Resource({route:'/admin/ajax/settings'}).put('altrp_user_load', {value});\r\n    this.setState(state=>({\r\n      ...state,\r\n      loadByUser: value,\r\n    }))\r\n  };\r\n\r\n  /**\r\n   * Удалить всю историю всех шаблонов\r\n   * @param e\r\n   */\r\n  deleteAllTemplatesReviews = async (e) =>{\r\n    let result  = await confirm('Are You Sure');\r\n    if(! result){\r\n      return;\r\n    }\r\n    store.dispatch(setAdminDisable());\r\n    let res = await new Resource({route:'/admin/ajax/reviews'}).delete();\r\n    if(res.success){\r\n      await alert('success');\r\n    }\r\n    store.dispatch(setAdminEnable());\r\n  };\r\n\r\n  /**\r\n   * Запрос на очистку кэша\r\n   */\r\n  clearAllCache = async (e) =>{\r\n    let result  = await confirm('Are You Sure');\r\n    if(! result){\r\n      return;\r\n    }\r\n    let res = await new Resource({route:'/admin/ajax/clear_cache'}).delete();\r\n\r\n  };\r\n  /**\r\n   * Обновить всех ресурсы на бкенде (модели, шаблоны, контроллеры и т.д.)\r\n   * @param e\r\n   */\r\n  updateAllBackendResources = async (e) =>{\r\n    let result  = await confirm('Are You Sure');\r\n    if(! result){\r\n      return;\r\n    }\r\n    store.dispatch(setAdminDisable());\r\n\r\n    let res = await new Resource({route:'/admin/ajax/update-all-resources'}).post({});\r\n    if(res.success){\r\n      await alert('success');\r\n    }\r\n    store.dispatch(setAdminEnable());\r\n  };\r\n  render() {\r\n    return <div className=\"admin-styles-settings\">\r\n\r\n      <div className=\"advanced__settings\">\r\n        <div className=\"admin-styles-advanced-blocks\">\r\n          <div className=\"admin-styles-advanced-block\">\r\n            <label htmlFor=\"settings-container-width\" className=\"admin__logo-advanced\">\r\n              Admin Logo:\r\n            </label>\r\n            <Suspense fallback={'Loading'}>\r\n              <MediaInput onChange={this.changeAdminLogo} value={this.props.adminLogo}/>\r\n            </Suspense>\r\n          </div>\r\n\r\n          <div className=\"admin-styles-advanced\">\r\n            <div className=\"admin-styles-advanced-block\">\r\n              <div className=\"advanced-text-custom\">Clear All Templates History:</div>\r\n              <button className=\"btn btn_success btn_advanced\"\r\n                      onClick={this.deleteAllTemplatesReviews}>\r\n                Clear\r\n              </button>\r\n            </div>\r\n\r\n            <div className=\"admin-styles-advanced-block\">\r\n              <div className=\"advanced-text-custom\">Update All Backend Resources:</div>\r\n              <button className=\"btn btn_success btn_advanced\"\r\n                      onClick={this.updateAllBackendResources}>\r\n                Update\r\n              </button>\r\n            </div>\r\n\r\n            <div className=\"admin-styles-advanced-block\">\r\n              <div className=\"advanced-text-custom\">Clear All Cache:</div>\r\n              <button className=\"btn btn_success btn_advanced\"\r\n                      onClick={this.clearAllCache}>\r\n                Clear\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"admin-styles-advanced\">\r\n            <div className=\"admin-styles-advanced-block advanced-flex\">\r\n              <div className=\"advanced-text\">Debug Altrp App</div>\r\n              <input className=\"admin-table__td_check\"\r\n                     onChange={this.toggleDebug}\r\n                // value={this.state.debugOn}\r\n                     checked={this.state.debugOn}\r\n                     type=\"checkbox\"/>\r\n            </div>\r\n\r\n            <div className=\"admin-styles-advanced-block advanced-flex\">\r\n              <div className=\"advanced-text\">Load App on User Action</div>\r\n              <input className=\"admin-table__td_check\"\r\n                     onChange={this.toggleLoadingOption}\r\n                // value={this.state.debugOn}\r\n                     checked={this.state.loadByUser}\r\n                     type=\"checkbox\"/>\r\n            </div>\r\n          </div>\r\n      </div>\r\n\r\n        <div className=\"editor-js__block\">\r\n          <div className=\"admin-styles-advanced-block no-margin \">\r\n            <div className=\"advanced-text-custom\">Add Custom Javascript on All Site Pages:</div>\r\n            <AltrpCodeEditor value={this.state.allSiteJavascript}\r\n                             mode=\"javascript\"\r\n                             onChange={value => this.setState({ allSiteJavascript: value})}\r\n                             height=\"40em\"\r\n                             style={{\r\n                               width: '100%'\r\n                             }}\r\n            />\r\n            <button className=\"btn btn_success btn_advanced\"\r\n                    onClick={this.updateAllSiteJavascript}>\r\n              Update\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n      </div>\r\n\r\n\r\n        {/*<tr className=\"admin-settings-table-row\">*/}\r\n          {/*<td className=\"admin-settings-table__td row-text\" width=\"10%\">*/}\r\n            {/*Clear All Templates History*/}\r\n          {/*</td>*/}\r\n          {/*<td className=\"admin-settings-table__td\">*/}\r\n            {/*<button className=\"btn btn_success\"*/}\r\n                    {/*onClick={this.deleteAllTemplatesReviews}>*/}\r\n              {/*Clear*/}\r\n            {/*</button>*/}\r\n          {/*</td>*/}\r\n        {/*</tr>*/}\r\n    </div>\r\n  }\r\n\r\n  /**\r\n   * Сохранить код JS для всего сайта\r\n   */\r\n   updateAllSiteJavascript = async() => {\r\n    await new Resource({route:'/admin/ajax/settings'}).put('all_site_js', {value: this.state.allSiteJavascript, encrypt: true});\r\n  };\r\n}\r\n\r\nfunction mapStateToProps(state) {\r\n  return {\r\n    adminLogo: state.adminLogo,\r\n  };\r\n}\r\n\r\nexport default connect(mapStateToProps)(AdvancedSettings);\r\n"],"sourceRoot":""}